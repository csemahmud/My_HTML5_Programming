/*!CK:3466194540!*//*1390272516,178158885*/

if (self.CavalryLogger) { CavalryLogger.start_js(["k\/MmL"]); }

__d("BookmarksSeeAll",["Arbiter","AsyncRequest","CSS","DOM","Event","NavigationMessage","Parent","Toggler","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('NavigationMessage'),m=b('Parent'),n=b('Toggler'),o=b('copyProperties'),p=b('tx');function q(){}o(q.prototype,{init:function(r){this.root=r;g.subscribe(l.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this));g.subscribe(l.NAVIGATION_ITEM_REMOVED,this.removeItem.bind(this));g.subscribe(l.NAVIGATION_ITEM_HIDDEN,this.markItemHidden.bind(this));g.subscribe(l.NAVIGATION_COUNT_UPDATE,this.countUpdate.bind(this));this.setSeeAllMenuOptions();},setSeeAllMenuOptions:function(){k.listen(this.root,'click',function(event){var r=event.getTarget();if(m.byClass(r,'seeAllItem'))if(m.byClass(r,'favorite')){this._handleFavorite(event);}else if(m.byClass(r,'alwaysHidden'))this._handleAlwaysHidden(event);}.bind(this));},_handleFavorite:function(event){var r=event.getTarget(),s=m.byClass(r,'seeAllItem'),t=s.id.replace('seeAllItem_',''),u=!i.hasClass(s,'favoriteItem');g.inform(l.NAVIGATION_FAVORITE_UPDATE,{key:t,favorite:u});},_handleAlwaysHidden:function(event){var r=event.getTarget(),s=m.byClass(r,'alwaysHidden'),t=m.byClass(r,'seeAllItem').id.replace('seeAllItem_',''),u=i.hasClass(s,'checked')?'/ajax/bookmark/unhide/':'/ajax/bookmark/hide/';new h().setURI(u).setData({id:t}).setHandler(i.toggleClass.bind(this,s,'checked')).send();},_getItem:function(r){return j.scry(this.root,'li.key-'+r)[0];},_findEditSpan:function(r){return j.find(r,'div.bookmarksMenuButton li.favorite span.itemLabel');},updateFavorite:function(r,s){var t=this._getItem(s.key);if(t){var u;if(s.favorite){i.addClass(t,'favoriteItem');var v=j.scry(t,'.alwaysHidden')[0];v&&i.removeClass(v,'checked');u="Remove from Favorites";}else{i.removeClass(t,'favoriteItem');u="Add to Favorites";}var w=this._findEditSpan(t);j.setContent(w,u);}n.hide();},removeItem:function(r,s){var t=this._getItem(s);j.remove(t);},markItemHidden:function(r,s){var t=this._getItem(s);if(t){var u=j.find(t,'.uiSelectorMenu .alwaysHidden');i.addClass(u,'checked');}},countUpdate:function(r,s){var t=this._getItem(s&&s.key);if(t){var u=j.scry(t,'span.count')[0],v=u&&j.scry(u,'span.countValue')[0];if(v){var w=0;if(typeof s.count!=="undefined"){w=s.count;}else if(typeof s.increment!=="undefined"){w=s.increment+parseInt(j.getText(v),10);}else return;w=w<0?0:w;j.setContent(v,w);i.conditionClass(u,'hidden_elem',w===0);}}}});e.exports=q;});
__d("legacy:bookmarks-seeall-js",["BookmarksSeeAll"],function(a,b,c,d){a.BookmarksSeeAll=b('BookmarksSeeAll');},3);
__d("PageStars",["Event","Locale","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Locale'),i=b('Style'),j=b('copyProperties'),k=5;function l(m,n,o,p,q,r,s,t){this.myRating=q;this.avgRating=p;this.avgStars=n;this.myStars=o;this.margin=t;this.width=r;this.height=s;for(var u=0;u<m.length;u++){var v=m[u],w=u+1;for(var x=0;x<v.length;x++){if(!v[x])continue;g.listen(v[x],'mouseenter',this._hover.bind(this,w));g.listen(v[x],'mouseleave',this._mouseout.bind(this,w));g.listen(v[x],'click',this._click.bind(this,w));}}}j(l.prototype,{onClick:function(m){this.callback=m;},_updateUI:function(){if(this.hovered||this.myRating){this.avgStars&&this._setClip(this.avgStars,0);this.myStars&&this._setClip(this.myStars,this.hovered||this.myRating);}else{this.myStars&&this._setClip(this.myStars,0);this.avgStars&&this._setClip(this.avgStars,this.avgRating||0);}},_setClip:function(m,n){var o=Math.round(n*this.width+Math.floor(n)*this.margin),p=0;if(h.isRTL()){p=Math.round((k-n)*this.width+Math.floor(k-n)*this.margin);o+=p;}var q='rect(0px, '+o+'px, '+this.height+'px, '+p+'px)';i.set(m,'clip',q);},_click:function(m){this.myRating=m;this._updateUI();return this.callback&&this.callback(m);},_hover:function(m){this.hovered=m;this._updateUI();},_mouseout:function(m){if(this.hovered===m){this.hovered=null;this._updateUI();}},setAverageRating:function(m){this.avgRating=m;this._updateUI();},setMyRating:function(m){this.myRating=m;this._updateUI();}});e.exports=l;});
__d("PageReviewInlineComposer",["Event","DOM","CSS"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('CSS'),j={initControls:function(k,l,m,n,o){var p=h.scry(k,'textarea')[0];if(!o)p&&g.listen(p,'focus',function(){i.addClass(p,'expand');l&&i.show(l);});n.onClick(function(q,r){q.setAttribute('value',r);p.focus();}.bind(null,m));},clearTextarea:function(k){var l=h.find(document.body,'#'+k),m=h.scry(l,'textarea[name="note_message"]')[0];m.value='';}};e.exports=j;});
__d("CovercardArrow",["ContextualDialogArrow","CSS","DOMQuery","Locale","Style","csx","cx"],function(a,b,c,d,e,f){var g=b('ContextualDialogArrow'),h=b('CSS'),i=b('DOMQuery'),j=b('Locale'),k=b('Style'),l=b('csx'),m=b('cx'),n=-45,o=45,p=10;if(j.isRTL()){n=-n;o=-o;}function q(s){"use strict";this._layer=s;}q.prototype.enable=function(){"use strict";this._layer.enableBehavior(g);var s=this._layer.getContentRoot();this._arrowWrapper=i.scry(s,"._7lh")[0];if(!this._arrowWrapper)return;this._arrowShadow=i.scry(this._arrowWrapper,"._7li")[0];if(!this._arrowShadow)return;var t=null;if(this._arrowWrapper.style.webkitMaskPosition!==undefined){t=this._renderArrowWithWebkitMask.bind(this);h.addClass(s,"_7ld");}else if(r(this._arrowWrapper)){t=this._renderArrowWithRotate.bind(this);h.addClass(s,"_7le");}if(!t)return;if(j.isRTL())h.addClass(s,"_7lf");this._subscription=this._layer.subscribe('reposition',function(u,v){var w=v.getPosition()=='below';h.conditionClass(s,"_53ih",w);w&&t(v);});};q.prototype.disable=function(){"use strict";this._subscription&&this._subscription.unsubscribe();this._subscription=null;};q.prototype._calculateArrowOffset=function(s){"use strict";var t=g.getOffsetPercent(s),u=g.getOffset(s,t,this._layer),v=k.get(this._layer.getContentRoot(),'width');return parseInt(v,10)*(t/100)+u;};q.prototype._renderArrowWithWebkitMask=function(s){"use strict";var t=g.getOffsetSide(s),u=this._calculateArrowOffset(s);if(j.isRTL()){var v=k.get(this._layer.getContentRoot(),'width');u=parseInt(v,10)-u-this._layer.getArrowDimensions().offset;t=t=='left'?'right':'left';}k.set(this._arrowWrapper,'webkitMaskPositionX',u+'px');k.set(this._arrowShadow,t,u+'px');};q.prototype._renderArrowWithRotate=function(s){"use strict";var t=i.scry(this._arrowWrapper,"._7lj")[0];if(!t)return;var u=r(this._arrowWrapper);if(!u)return;var v=this._calculateArrowOffset(s),w=p+v;if(j.isRTL())w=-w;this._arrowWrapper.style[u]='translate('+w+'px, -'+p+'px) '+'rotate('+o+'deg)';t.style[u]='rotate('+n+'deg) '+'translate('+(-w)+'px, 0px)';};function r(s){if(!s)s=document.body;var t=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],u;while(u=t.shift())if(s.style[u]!==undefined)return u;return null;}e.exports=q;});