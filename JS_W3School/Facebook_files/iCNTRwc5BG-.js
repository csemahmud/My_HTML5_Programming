/*!CK:2553717310!*//*1390514294,178127387*/

if (self.CavalryLogger) { CavalryLogger.start_js(["7QQjP"]); }

__d("BusinessConf",[],function(a,b,c,d,e,f){e.exports={DOMAIN:"business",BIZ_ID_PARAM_NAME:"business_id",LABEL_ID_PARAM_NAME:"label_id",ACCOUNT_ID_PARAM_NAME:"act",PAGE_ID_PARAM_NAME:"id",PAGE_ADMIN_SELECTED_KEY:"sk",LEGACY_ADS_MANAGER_PREFIX:"\/ads\/manage\/",WHITELISTED_URI_CLASS:"bizOK",OPT_OUT_KEY:"do_not_redirect_to_biz_site",OPT_OUT_EXPIRE:86400};});
__d("BizSiteIdentifier.brands",["BusinessConf","URI"],function(a,b,c,d,e,f){var g=b('BusinessConf'),h=b('URI'),i={isBizSite:function(){return h.getRequestURI().getSubdomain()===g.DOMAIN;},getBusinessID:function(){return h.getRequestURI().getQueryData()[g.BIZ_ID_PARAM_NAME];},createBusinessURL:function(j,k){var l=h(j).setSubdomain(g.DOMAIN),m=k||i.getBusinessID();l.addQueryData(g.BIZ_ID_PARAM_NAME,m);return l.toString();}};e.exports=i;});
__d("NotificationCounter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DocumentTitle'),i=b('JSLogger'),j={messages:0,notifications:0,requests:0},k={init:function(l){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var l=0;for(var m in j){var n=Number(j[m]);if(typeof j[m]=='string'&&isNaN(n))return j[m];if(isNaN(n)||n<0){i.create('jewels').error('bad_count',{jewel:m,count:j[m]});continue;}l+=n;}return l;},updateTitle:function(){var l=this.getCount(),m=h.get();m=l?'('+l+') '+m:m;h.set(m,true);},_handleCountUpdate:function(l,m){j[m.jewel]=m.count;this.updateTitle();},_handleUpdate:function(l,m){this.updateTitle();}};e.exports=k;});
__d("NotificationJewelController",["Arbiter","Event","CommunityNotificationFilter","NotificationConstants","NotificationCounter","NotificationSeenState","NotificationStore","NotificationUpdates","NotificationUserActions","createObjectFrom","curry"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Event'),i=b('CommunityNotificationFilter'),j=b('NotificationConstants'),k=b('NotificationCounter'),l=b('NotificationSeenState'),m=b('NotificationStore'),n=b('NotificationUpdates'),o=b('NotificationUserActions'),p=b('createObjectFrom'),q=b('curry'),r=0;function s(v){var w=l.getUnseenIDs();return m.getFilteredIDs(w,function(x){return m.filterNotification(x,v);});}function t(v,w){g.inform('jewel/count-updated',{jewel:w,count:s(v).length},g.BEHAVIOR_STATE);}function u(v,w,x,y,z){z.subscribe('tabselected',function(event,da){w.setFilter(da.filter);});k.init();var aa=h.listen(v.getRoot(),'mouseover',function(){aa.remove();aa=null;w.open();});if(v.isOpen()){w.open();}else var ba=v.subscribe('opened',function(){ba.unsubscribe();ba=null;w.open();});var ca=w.pause.bind(w);v.subscribe('opened',function(){setTimeout(ca,0);var da=s(y);if(da.length)o.markNotificationsAsSeen(da);});v.subscribe('closed',function(){w.unpause();t(y,v.name);});n.subscribe('seen-state-updated',q(t,y,v.name));n.handleUpdate(j.PayloadSourceType.INITIAL_LOAD,{seenState:p(x,r),isCommunity:y==i.WORK});}e.exports=u;});
__d("NotificationJewelHeaderController",["ArbiterMixin","CSS","Event","NotificationSeenState","NotificationStore","NotificationUserActions","cx","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('CSS'),i=b('Event'),j=b('NotificationSeenState'),k=b('NotificationStore'),l=b('NotificationUserActions'),m=b("cx"),n=b("mixin"),o=n(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(s,t,u){"use strict";u.forEach(function(v,w){i.listen(v,'click',function(){for(var x=0;x<u.length;x++)h.removeClass(u[x],"_5ysh");h.addClass(v,"_5ysh");this.inform('tabselected',{filter:w});}.bind(this));}.bind(this));if(s)i.listen(s,'click',function(){var v=j.getUnreadIDs();v=k.getFilteredIDs(v,function(w){return k.filterNotification(w,t);});if(v.length)l.markNotificationsAsRead(v);});}e.exports=r;});
__d("NotificationHiddenState",["NotificationUpdates","copyProperties"],function(a,b,c,d,e,f){var g=b('NotificationUpdates'),h=b('copyProperties'),i={};g.subscribe('update-hidden',function(k,l){if(l.hiddenState){i=h(i,l.hiddenState);g.didUpdateHiddenState(Object.keys(l.hiddenState));}});var j={isHidden:function(k){if(i[k])return i[k];return false;}};e.exports=j;});
__d("XNotificationInlineStoryControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/desktop_notifications\/inline_story\/",{notif_id:{type:"String",required:true},flyout_id:{type:"String",required:true}});});
__d("XNotificationInlineStoryLoggingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/desktop_notifications\/inline_story_logging\/",{screen_wide_enough:{type:"Bool"},is_snowlift:{type:"Bool"},is_vault_set:{type:"Bool"},is_aggregated_story:{type:"Bool"},should_fallback:{type:"Bool"}});});
__d("NotificationJewelItem.react",["Arbiter","AsyncRequest","AsyncResponse","BizSiteIdentifier.brands","CloseButton.react","DOM","Event","FlexibleBlock.react","ImageBlock.react","Keys","NotificationPhotoThumbnail","NotificationURI","NotificationUserActions","React","TextWithEntities.react","Timestamp.react","VaultBoxURI","Vector","XNotificationInlineStoryControllerURIBuilder","XNotificationInlineStoryLoggingControllerURIBuilder","XUIButton.react","XUISpinner.react","cx","emptyFunction","invariant","mergeObjects","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('BizSiteIdentifier.brands'),k=b('CloseButton.react'),l=b('DOM'),m=b('Event'),n=b('FlexibleBlock.react'),o=b('ImageBlock.react'),p=b('Keys'),q=b('NotificationPhotoThumbnail'),r=b('NotificationURI'),s=b('NotificationUserActions'),t=b('React'),u=b('TextWithEntities.react'),v=b('Timestamp.react'),w=b('VaultBoxURI'),x=b('Vector'),y=b('XNotificationInlineStoryControllerURIBuilder'),z=b('XNotificationInlineStoryLoggingControllerURIBuilder'),aa=b('XUIButton.react'),ba=b('XUISpinner.react'),ca=b('cx'),da=b('emptyFunction'),ea=b('invariant'),fa=b('mergeObjects'),ga=b('tx'),ha=950;function ia(la,ma){return t.DOM.span({className:"fwb"},la);}function ja(la){return !!(la&&la.id&&!la.is_facebook_app);}var ka=t.createClass({displayName:'NotificationJewelItem',getInitialState:function(){return {showingOptions:false,negativeFeedbackConfirmation:null,canReportAsSpam:false,spamReportConfirmation:null,sendingFeedback:false,mayUndoHide:false,firstReceiptHandled:false,showLoadingIndicator:false,isBizSite:j.isBizSite()};},_onKeyDownItem:function(la){if(m.getKeyCode(la.nativeEvent)==p.RETURN)this._markItemRead();},_markItemRead:function(){s.markNotificationsAsRead([this.props.alert_id]);},_onFeedbackError:function(la){i.defaultErrorHandler(la);this.setState({sendingFeedback:false});},_onHideSuccess:function(la){var ma=la.getPayload();ea(ma.confirmation);this.setState({negativeFeedbackConfirmation:ma.confirmation,canReportAsSpam:ma.canReportAsSpam,sendingFeedback:false});},_onHideAppSuccess:function(la){var ma=la.getPayload(),na=ma.confirmation,oa=ma.canReportAsSpam;ea(na);this.setState({negativeFeedbackConfirmation:na,canReportAsSpam:oa,mayUndoHide:true,sendingFeedback:false,showingOptions:true});},_onSpamReportSuccess:function(la){var ma=la.getPayload().spamReportConfirmation;this.setState({negativeFeedbackConfirmation:null,spamReportConfirmation:ma,sendingFeedback:false});},_onHide:function(){s.markNotificationAsHidden(this.props.alert_id,this._onHideSuccess,this._onFeedbackError);this.setState({sendingFeedback:true,mayUndoHide:true});},_onShow:function(){var la=this.props.negative?this.props.negative.subscription_level:null;s.markNotificationAsVisible(this.props.alert_id,la,function(){this.setState({negativeFeedbackConfirmation:null,sendingFeedback:false,showingOptions:false});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_onReportSpam:function(){s.markNotificationAsSpam(this.props.alert_id,this._onSpamReportSuccess,this._onFeedbackError);this.setState({sendingFeedback:true});},_markAppAsHidden:function(){s.markAppAsHidden(this.props.alert_id,this.props.application.id,this._onHideAppSuccess,this._onFeedbackError);this.setState({sendingFeedback:true});},_markAppAsVisible:function(){s.markAppAsVisible(this.props.alert_id,this.props.application.id,function(){this.setState({negativeFeedbackConfirmation:null,sendingFeedback:false,showingOptions:false,mayUndoHide:false});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_onFirstReceiptYes:function(){s.markFirstReceiptYes(this.props.alert_id,function(){this.props.onHandleFirstReceipt(this.props.application.id);this.setState({firstReceiptHandled:true});}.bind(this),da);},_onFirstReceiptNo:function(){s.markFirstReceiptNo(this.props.alert_id,function(){this._markAppAsHidden();this.props.onHandleFirstReceipt(this.props.application.id);this.setState({firstReceiptHandled:true});}.bind(this),this._onFeedbackError);this.setState({sendingFeedback:true});},_renderAttachedImage:function(la){if(la)return (t.DOM.img({src:la.uri,className:"_42td",'aria-hidden':true}));return t.DOM.span(null);},_getModifiedTrackingString:function(la){return JSON.stringify(fa(JSON.parse(this.props.tracking),la));},_onClickCloseButton:function(){this.setState({showingOptions:true});},_onCancelNegativeFeedback:function(){this.setState({showingOptions:false});},shouldComponentUpdate:function(la,ma){return (this.props.visible!==la.visible||this.props.isRead!==la.isRead||this.props.timestamp!==la.timestamp||this.state.showingOptions!==ma.showingOptions||this.state.sendingFeedback!==ma.sendingFeedback||this.state.canReportAsSpam!==ma.canReportAsSpam||this.state.spamReportConfirmation!==ma.spamReportConfirmation||this.state.showLoadingIndicator!==ma.showLoadingIndicator);},render:function(){if(!this.props.visible&&!this.state.mayUndoHide)return t.DOM.li({className:"_4_62"});var la=this.props.negative,ma=this.props.negativeTracking,na=(("_33c")+(!this.props.isRead?' '+"_4af":'')+(this.state.showingOptions?' '+"_4ag":'')+(this.state.sendingFeedback?' '+"_4m8s":''));if(this.state.negativeFeedbackConfirmation){var oa=this.state.negativeFeedbackConfirmation,pa;if(this.state.canReportAsSpam)pa=t.DOM.span(null,t.DOM.span({className:"mhs"},"·"),t.DOM.a({href:"#",onClick:this._onReportSpam},"Report app for spam"));var qa=ja(this.props.application)?this._markAppAsVisible:this._onShow;return (t.DOM.li({className:na,'data-gt':this.props.tracking},t.DOM.div({className:"_4ai"},u({interpolator:ia,ranges:oa.ranges,aggregatedranges:oa.aggregated_ranges,text:oa.text}),t.DOM.a({href:"#",onClick:qa,className:"mls"},"Undo"),pa)));}var ra=this.state.spamReportConfirmation;if(ra)return (t.DOM.li({className:na,'data-gt':this.props.tracking},t.DOM.div({className:"_4ai"},u({interpolator:ia,ranges:ra.ranges,aggregatedranges:ra.aggregated_ranges,text:ra.text}))));if(this.state.showingOptions){var sa=ja(this.props.application)?this._markAppAsHidden:this._onHide;return (t.DOM.li({className:na,'data-gt':this.props.tracking},t.DOM.div({className:"_4ai"},t.DOM.div(null,u({interpolator:ia,ranges:la.confirm_question.ranges,aggregatedranges:la.confirm_question.aggregated_ranges,text:la.confirm_question.text})),t.DOM.div({className:"mts"},aa({'data-gt':this._getModifiedTrackingString(ma.confirm),href:{url:'#'},label:la.turn_off,use:"confirm",onClick:sa,disabled:this.state.sendingFeedback}),aa({'data-gt':this._getModifiedTrackingString(ma.cancel),href:{url:'#'},label:"Keep On",onClick:this._onCancelNegativeFeedback,disabled:this.state.sendingFeedback})))));}var ta=null;if(this.props.title)ta=u({interpolator:ia,ranges:this.props.title.ranges,aggregatedranges:this.props.title.aggregated_ranges,text:this.props.title.text,renderEmoji:true,renderEmoticons:true});var ua=null,va=null,wa=null;if(la){var xa=this._onClickCloseButton,ya;if(this.props.isFirstReceipt){va=t.DOM.span({className:"_540_"},"NEW");xa=this._onFirstReceiptNo;wa=this._onFirstReceiptYes;ya=this._getModifiedTrackingString(ma.firstReceiptNo);}else ya=this._getModifiedTrackingString(ma.click);var za=(("_4ah")+(' '+"_55m9"));ua=k({className:za,'data-gt':ya,size:"medium",tooltip:la.button_tooltip,onClick:xa,ref:"closeButton"});}var ab=r.localize(this.props.url),bb=q.getThumbnail(this.props.attachments,this.props.attached_story,this.props.feedback_context),cb=bb&&r.snowliftable(ab),db=r.isVaultSetURI(ab),eb=(("_55m9")+(!this.props.isRead?' '+"_5c9q":'')+(this.props.isRead?' '+"_5c9_":'')),fb=t.DOM.a({href:"#",className:eb,role:"button",'aria-label':this.props.isRead?"Read":"Mark as Read",'data-hover':"tooltip",'data-tooltip-alignh':"center",onClick:this.props.isRead?null:this._markItemRead}),gb=(cb||db)?ab:this.props.ajaxify_url,hb=null,ib=null,jb=db?w.getSyncedTabURI().toString():ab;if(cb){hb='theater';}else if(db||gb)hb='dialog';var kb=null,lb=this.props.actors[0];if(lb)kb={backgroundImage:'url('+lb.profile_picture.uri+')'};var mb='notif_flyout_'+this.props.alert_id,nb=null,ob=this.props.substory_count>0,pb=false;this.props.attachments.forEach(function(sb){if(pb)return;pb=sb.style_list.indexOf("notification_target")>=0||sb.style_list.indexOf("question")>=0;if(pb)return;});var qb=false;if(this.props.storyInline){var rb=x.getViewportDimensions().x>ha;if(rb&&!cb&&!db&&!ob&&!pb)qb=true;ib=this._openItemFlyout(ab,mb,rb,cb,db,ob,pb);if(rb&&!cb&&!db&&!pb&&!ob){hb=null;if(this.state.showLoadingIndicator)nb=ba({color:"white",background:"light",className:"_5vp8",size:"large"});}}return (t.DOM.li({className:na,'data-gt':this.props.tracking,onMouseLeave:wa},t.DOM.div({className:"anchorContainer"},t.DOM.a({id:mb,href:jb,ajaxify:gb,className:"_33e",rel:hb,onClick:ib,onMouseDown:this._markItemRead,onKeyDown:this._onKeyDownItem},o(null,t.DOM.span({style:kb,className:"_33h"},t.DOM.img({src:"/images/notif_flyout_indicator.png",className:(("flyoutNoIndicator")+(qb?' '+"flyoutShowIndicator":''))})),n({flex:n.FLEX.left},t.DOM.div({className:"_4l_v"},ta,va,o({className:(("_33f")+(this.state.isBizSite?' '+"_2g48":''))},t.DOM.img({src:this.props.icon.uri}),t.DOM.span(null,v({time:this.props.timestamp.time,text:this.props.timestamp.text,verbose:this.props.timestamp.verbose,className:"_33g"})))),this._renderAttachedImage(bb))),nb),fb,ua)));},_openItemFlyout:function(la,ma,na,oa,pa,qa,ra){return function(event){if(event.type==='click'&&(event.button!==0||event.altKey||event.ctrlKey||event.shiftKey||event.metaKey))return true;var sa=new z().setBool('screen_wide_enough',na).setBool('is_snowlift',oa).setBool('is_vault_set',pa).setBool('is_aggregated_story',qa).setBool('should_fallback',ra).getURI();new h().setURI(sa).send();if(!na||oa||pa||qa||ra)return;event.preventDefault();g.subscribeOnce('inlineStory/flyoutLoaded',function(){this.setState({showLoadingIndicator:false});}.bind(this));setTimeout(function(){this.state.showLoadingIndicator&&window.open(l.find(document,'#'+ma).href,'_self');}.bind(this),3000);this.setState({showLoadingIndicator:true});var ta=new y().setString('notif_id',this.props.id).setString('flyout_id',ma).getURI();new h().setURI(ta).send();}.bind(this);}});e.exports=ka;});
__d("objFilter",[],function(a,b,c,d,e,f){"use strict";function g(h,i,j){if(!h)return null;var k=0,l={};for(var m in h)if(h.hasOwnProperty(m)&&i.call(j,h[m],m,k++))l[m]=h[m];return l;}e.exports=g;});
__d("NotificationJewelList.react",["Animation","Event","NotificationConstants","NotificationHiddenState","NotificationJewelItem.react","NotificationSeenState","NotificationStore","NotificationUpdates","React","LegacyScrollableArea.react","Vector","copyProperties","createObjectFrom","cx","debounce","getObjectValues","isEmpty","merge","objFilter","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Event'),i=b('NotificationConstants'),j=b('NotificationHiddenState'),k=b('NotificationJewelItem.react'),l=b('NotificationSeenState'),m=b('NotificationStore'),n=b('NotificationUpdates'),o=b('React'),p=b('LegacyScrollableArea.react'),q=b('Vector'),r=b('copyProperties'),s=b('createObjectFrom'),t=b('cx'),u=b('debounce'),v=b('getObjectValues'),w=b('isEmpty'),x=b('merge'),y=b('objFilter'),z=b('tx'),aa=5,ba=160,ca=530,da=40,ea=332,fa=430,ga=i.PayloadSourceType.LIVE_SEND;function ha(ja){return !!(ja.application&&ja.application.id&&ja.negative&&ja.negative.show_first_receipt&&!ja.application.is_facebook_app);}var ia=o.createClass({displayName:'NotificationJewelList',getInitialState:function(){this._currentlyFetching=false;this._pendingNotifs={};this._shouldScroll=false;return {canFetchMore:true,notifs:{},hiddenState:{},readState:{},firstReceiptsHandled:{}};},componentWillMount:function(){this._filter=function(ja){return m.filterNotification(ja,this.props.filter);}.bind(this);m.setBusinessID(this.props.businessID);m.setShouldRankNotifs(this.props.rankedNotifs);this._subscriptions=[n.subscribe('notifications-updated',function(ja,ka){if(ka.source==ga&&!w(ka.updates)){this._shouldScroll=true;if(this.props.paused)this._pendingNotifs=x(this._pendingNotifs,ka.updates);return;}this._fetchAndUpdate(m.getCount(this._filter));}.bind(this)),n.subscribe(['hidden-state-updated','read-state-updated'],function(ja,ka){if(ja=='hidden-state-updated'){var la={};Object.keys(ka.updates).forEach(function(na){la[na]=j.isHidden(na);});this.setState({hiddenState:x(this.state.hiddenState,la)});}else{var ma={};Object.keys(ka.updates).forEach(function(na){ma[na]=l.isRead(na);});this.setState({readState:x(this.state.readState,ma)});}}.bind(this))];},componentWillUnmount:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._subscriptions=null;},_fetchAndUpdate:function(ja){this._currentlyFetching=true;m.getNotifications(ja,this.props.filter,function(ka,la){if(la!==this.props.filter)return;var ma=y(ka,this._filter),na=w(this._pendingNotifs)?ma:this._getNotifsWithCurrentOrder(ma);this._currentlyFetching=false;this.setState({notifs:na,canFetchMore:m.canFetchMore(this.props.filter)});}.bind(this));},_getNotifsWithCurrentOrder:function(ja){var ka=Object.keys(this.state.notifs),la=Object.keys(ja).filter(function(na){return !this.state.notifs[na];}.bind(this));ka=ka.concat(la);var ma={};ka.forEach(function(na){if(this._pendingNotifs[na]){var oa=this.state.notifs[na];if(oa)ma[na]=oa;}else ma[na]=ja[na];}.bind(this));return ma;},_fetchAndUpdateAll:function(){this._pendingNotifs={};this._fetchAndUpdate(m.getCount(this._filter));},_fetchNextSet:function(){if(!this._currentlyFetching){var ja=Object.keys(this.state.notifs).length;this._fetchAndUpdate(ja+aa);}},_onScroll:function(){if(this._currentlyFetching||!this.state.canFetchMore)return;if(this._isLoadingIndicatorVisible())this._fetchNextSet();},_isLoadingIndicatorVisible:function(){var ja=this.refs.loading;if(!ja)return false;var ka=this.refs.scrollable.getDOMNode(),la=q.getElementDimensions(ka).y;if(la===0)return false;var ma=q.getElementPosition(ka).y+la,na=q.getElementPosition(ja.getDOMNode()).y;na-=da;return na<ma;},_calculateHeight:function(){var ja=q.getViewportDimensions().y;return Math.min(ca,ja-ba);},_onHandleFirstReceipt:function(ja){if(!(ja in this.state.firstReceiptsHandled)){var ka=x(this.state.firstReceiptsHandled,s([ja]));this.setState({firstReceiptsHandled:ka});this._fetchNextSet();}},_renderItems:function(){var ja={},ka={};v(this.state.notifs).forEach(function(la){var ma=false,na=ha(la);if(na){var oa=la.application.id;ma=(!this.state.firstReceiptsHandled[oa]&&!ka[oa]);if(ma)ka[oa]=ma;}var pa=la.alert_id;ja[pa]=k(r({visible:!this.state.hiddenState[pa],isRead:this.state.readState[pa],negativeTracking:this.props.negativeTracking,isFirstReceipt:ma,onHandleFirstReceipt:this._onHandleFirstReceipt,storyInline:this.props.storyInline},la));}.bind(this));return ja;},componentDidMount:function(){var ja=this.refs.scrollable.getDOMNode();h.listen(window,'resize',u(function(){if(!w(this.state.notifs))new g(ja).to('height',this._calculateHeight()+'px').duration(100).go();}.bind(this)));},componentDidUpdate:function(ja){if(!ja.hasEverBeenOpened&&this.props.hasEverBeenOpened){var ka=m.getFilteredIDs(l.getUnseenIDs(),this._filter).length;if(ka>aa){this._fetchAndUpdate(ka);}else this._fetchNextSet();return;}if(ja.paused&&!this.props.paused){m.resortNotifs();setTimeout(this._fetchAndUpdateAll,0);return;}if(this.props.paused&&!ja.paused){if(this._shouldScroll&&this.refs.scrollable)this.refs.scrollable.getArea().scrollToTop(false);this._shouldScroll=false;}if(!this._currentlyFetching&&this._isLoadingIndicatorVisible())setTimeout(this._fetchNextSet,0);if(ja.filter!=this.props.filter)setTimeout(this._fetchAndUpdateAll,0);},render:function(){var ja=this.state.notifs,ka=null,la=null,ma=this.props.useWideList?fa:ea,na=null;if(!w(ja)){ka=o.DOM.ul({'data-gt':this.props.tracking},this._renderItems());la=this._calculateHeight();}else if(!this.state.canFetchMore)ka=o.DOM.div({className:"_572e"},"No new notifications");if(this.state.canFetchMore)na=o.DOM.img({ref:"loading",src:"/images/loaders/indicator_blue_small.gif",className:"_33i"});return (o.DOM.div({className:"_50-t"},p({ref:"scrollable",width:ma,height:la,fade:true,persistent:true,onScroll:u(this._onScroll)},ka,na)));}});e.exports=ia;});
__d("NotificationJewelListController",["NotificationJewelList.react","React","copyProperties"],function(a,b,c,d,e,f){var g=b('NotificationJewelList.react'),h=b('React'),i=b('copyProperties');function j(k,l){this._root=k;this._config=l;this._filter=this._config.filter;this._hasEverBeenOpened=false;this._paused=false;this._render();}i(j.prototype,{open:function(){this._hasEverBeenOpened=true;this._render();},pause:function(){this._paused=true;this._render();},unpause:function(){this._paused=false;this._render();},setFilter:function(k){this._filter=k;this._render();},_render:function(){var k=g({filter:this._filter,hasEverBeenOpened:this._hasEverBeenOpened,paused:this._paused,initialNotifs:this._config.initialNotifs||{},useWideList:this._config.useWideList,tracking:this._config.tracking,negativeTracking:this._config.negativeTracking,storyInline:this._config.storyInline,businessID:this._config.businessID,rankedNotifs:this._config.rankedNotifs});h.renderComponent(k,this._root);}});e.exports=j;});
__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("getHashtagRegex",[],function(a,b,c,d,e,f){function g(){var h='\xc0-\xd6'+'\xd8-\xf6'+'\xf8-\xff'+'\u0100-\u024f'+'\u0253-\u0254'+'\u0256-\u0257'+'\u0259'+'\u025b'+'\u0263'+'\u0268'+'\u026f'+'\u0272'+'\u0289'+'\u028b'+'\u02bb'+'\u0300-\u036f'+'\u1e00-\u1eff',i='\u0400-\u04ff'+'\u0500-\u0527'+'\u2de0-\u2dff'+'\ua640-\ua69f'+'\u0591-\u05bf'+'\u05c1-\u05c2'+'\u05c4-\u05c5'+'\u05c7'+'\u05d0-\u05ea'+'\u05f0-\u05f4'+'\ufb12-\ufb28'+'\ufb2a-\ufb36'+'\ufb38-\ufb3c'+'\ufb3e'+'\ufb40-\ufb41'+'\ufb43-\ufb44'+'\ufb46-\ufb4f'+'\u0610-\u061a'+'\u0620-\u065f'+'\u066e-\u06d3'+'\u06d5-\u06dc'+'\u06de-\u06e8'+'\u06ea-\u06ef'+'\u06fa-\u06fc'+'\u06ff'+'\u0750-\u077f'+'\u08a0'+'\u08a2-\u08ac'+'\u08e4-\u08fe'+'\ufb50-\ufbb1'+'\ufbd3-\ufd3d'+'\ufd50-\ufd8f'+'\ufd92-\ufdc7'+'\ufdf0-\ufdfb'+'\ufe70-\ufe74'+'\ufe76-\ufefc'+'\u200c-\u200c'+'\u0e01-\u0e3a'+'\u0e40-\u0e4e'+'\u1100-\u11ff'+'\u3130-\u3185'+'\uA960-\uA97F'+'\uAC00-\uD7AF'+'\uD7B0-\uD7FF'+'\uFFA1-\uFFDC',j=String.fromCharCode,k='\u30A1-\u30FA\u30FC-\u30FE'+'\uFF66-\uFF9F'+'\uFF10-\uFF19\uFF21-\uFF3A'+'\uFF41-\uFF5A'+'\u3041-\u3096\u3099-\u309E'+'\u3400-\u4DBF'+'\u4E00-\u9FFF'+j(173824)+'-'+j(177983)+j(177984)+'-'+j(178207)+j(194560)+'-'+j(195103)+'\u3003\u3005\u303B',l=h+i+k,m='\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6'+'\u00F8-\u0241\u0250-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EE\u037A\u0386'+'\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03CE\u03D0-\u03F5\u03F7-\u0481'+'\u048A-\u04CE\u04D0-\u04F9\u0500-\u050F\u0531-\u0556\u0559\u0561-\u0587'+'\u05D0-\u05EA\u05F0-\u05F2\u0621-\u063A\u0640-\u064A\u066E-\u066F'+'\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710'+'\u0712-\u072F\u074D-\u076D\u0780-\u07A5\u07B1\u0904-\u0939\u093D\u0950'+'\u0958-\u0961\u097D\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0'+'\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1'+'\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33'+'\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D'+'\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD'+'\u0AD0\u0AE0-\u0AE1\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30'+'\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83'+'\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F'+'\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0C05-\u0C0C\u0C0E-\u0C10'+'\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C60-\u0C61\u0C85-\u0C8C'+'\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE'+'\u0CE0-\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39'+'\u0D60-\u0D61\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6'+'\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88'+'\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7'+'\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6'+'\u0EDC-\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6A\u0F88-\u0F8B\u1000-\u1021'+'\u1023-\u1027\u1029-\u102A\u1050-\u1055\u10A0-\u10C5\u10D0-\u10FA\u10FC'+'\u1100-\u1159\u115F-\u11A2\u11A8-\u11F9\u1200-\u1248\u124A-\u124D'+'\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0'+'\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310'+'\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C'+'\u166F-\u1676\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711'+'\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7'+'\u17DC\u1820-\u1877\u1880-\u18A8\u1900-\u191C\u1950-\u196D\u1970-\u1974'+'\u1980-\u19A9\u19C1-\u19C7\u1A00-\u1A16\u1D00-\u1DBF\u1E00-\u1E9B'+'\u1EA0-\u1EF9\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D'+'\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC'+'\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC'+'\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107'+'\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D'+'\u212F-\u2131\u2133-\u2139\u213C-\u213F\u2145-\u2149\u2C00-\u2C2E'+'\u2C30-\u2C5E\u2C80-\u2CE4\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96'+'\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6'+'\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3006\u3031-\u3035'+'\u303B-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF'+'\u3105-\u312C\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5'+'\u4E00-\u9FBB\uA000-\uA48C\uA800-\uA801\uA803-\uA805\uA807-\uA80A'+'\uA80C-\uA822\uAC00-\uD7A3\uF900-\uFA2D\uFA30-\uFA6A\uFA70-\uFAD9'+'\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C'+'\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F'+'\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A'+'\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7'+'\uFFDA-\uFFDC',n='\u0300-\u036F\u0483-\u0486\u0591-\u05B9\u05BB-\u05BD\u05BF'+'\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u0615\u064B-\u065E\u0670'+'\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A'+'\u07A6-\u07B0\u0901-\u0903\u093C\u093E-\u094D\u0951-\u0954\u0962-\u0963'+'\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7-\u09C8\u09CB-\u09CD\u09D7'+'\u09E2-\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D'+'\u0A70-\u0A71\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD'+'\u0AE2-\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B43\u0B47-\u0B48\u0B4B-\u0B4D'+'\u0B56-\u0B57\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7'+'\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56'+'\u0C82-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5-\u0CD6'+'\u0D02-\u0D03\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D82-\u0D83'+'\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2-\u0DF3\u0E31\u0E34-\u0E3A'+'\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19'+'\u0F35\u0F37\u0F39\u0F3E-\u0F3F\u0F71-\u0F84\u0F86-\u0F87\u0F90-\u0F97'+'\u0F99-\u0FBC\u0FC6\u102C-\u1032\u1036-\u1039\u1056-\u1059\u135F'+'\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B6-\u17D3\u17DD'+'\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8-\u19C9'+'\u1A17-\u1A1B\u1DC0-\u1DC3\u20D0-\u20DC\u20E1\u20E5-\u20EB\u302A-\u302F'+'\u3099-\u309A\uA802\uA806\uA80B\uA823-\uA827\uFB1E\uFE00-\uFE0F'+'\uFE20-\uFE23',o='\u0030-\u0039\u0660-\u0669\u06F0-\u06F9\u0966-\u096F\u09E6-\u09EF'+'\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F'+'\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29'+'\u1040-\u1049\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9'+'\uFF10-\uFF19',p=m+n+l,q=o+'_',r=p+q,s='['+p+']',t='['+r+']',u='^|$|[^&'+r+']',v='[#\\uFF03]',w='('+u+')('+v+')('+t+'*'+s+t+'*)';return new RegExp(w,'ig');}e.exports=g;});
__d("HashtagParser",["URLMatcher","getHashtagRegex"],function(a,b,c,d,e,f){var g=b('URLMatcher'),h=b('getHashtagRegex'),i=100,j=30,k=/@\[([0-9]+):([0-9]+):((?:[^\\\]]*(?:\\.)*)*)\]/g;function l(da){var ea=y(da),fa=0,ga=0;return n(da).map(function(ha){while(fa<ea.length){var ia=ea[fa],ja=ia.offset-ga;if(ja<ha.offset){ga+=ia.token.length-ia.name.length;fa++;}else break;}return {marker:ha.marker,tag:ha.hashtag,rawOffset:ha.offset+ga,offset:ha.offset};});}function m(da){return o(da,t(da));}function n(da){var ea=aa(da);return o(ea,p(da,ea));}function o(da,ea){return r(da).slice(0,j).filter(function(fa){var ga=v(fa.offset,fa.hashtag.length,ea);return !ga&&fa.hashtag.length<=i;});}function p(da,ea){return u(s(da),t(ea));}var q=h();function r(da){var ea=[];da.replace(q,function(fa,ga,ha,ia,ja){ea.push({marker:ha,hashtag:ia,offset:ja+ga.length});});return ea;}function s(da){return ba(da).map(function(ea){return [ea.offset,ea.name.length];});}function t(da){var ea=[],fa,ga=0;while((fa=g.permissiveMatch(da))){var ha=da.indexOf(fa);ea.push([ga+ha,fa.length]);da=da.substring(ha+fa.length);ga+=ha+fa.length;}return ea;}function u(da,ea){var fa=[],ga=0,ha=0,ia=0;while(ga<da.length&&ha<ea.length)if(da[ga][0]>ea[ha][0]){fa[ia++]=ea[ha++];}else fa[ia++]=da[ga++];return fa.concat(da.slice(ga),ea.slice(ha));}function v(da,ea,fa){if(!fa)return false;var ga=x(fa,da);return w(da,ea,fa,ga)||w(da,ea,fa,ga+1);}function w(da,ea,fa,ga){if(!fa[ga])return false;var ha=fa[ga][0],ia=fa[ga][1];return !((da+ea-1<ha)||(da>ha+ia-1));}function x(da,ea){var fa=0,ga=da.length-1;while(fa<=ga){var ha=Math.floor((fa+ga)/2),ia=da[ha][0];if(ia==ea){return ha;}else if(ia<ea){fa=ha+1;}else ga=ha-1;}return ga;}function y(da){var ea=[];da.replace(k,function(fa,ga,ha,ia,ja){ea.push({token:fa,id:ga,type:ha,name:ia,offset:ja});});return ea;}function z(da){return da?da.replace(/\\([^\\])/g,'$1').replace(/\\\\/g,'\\'):null;}function aa(da){return da.replace(k,function(ea,fa,ga,ha,ia){return z(ha);});}function ba(da){var ea=0,fa=0;return y(da).map(function(ga){var ha=da.indexOf(ga.token,fa);fa=ha+1;ha-=ea;var ia=z(ga.name);ea+=ga.token.length-ia.length;if(ha>=0)return {id:ga.id,name:ia,type:ga.type,offset:ha};});}var ca={};ca.parse=l;ca.parseWithoutMentions=m;e.exports=ca;});
__d("FriendsCenterStickyController",["StickyController"],function(a,b,c,d,e,f){var g=b('StickyController');for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m,n){"use strict";g.call(this,k,l,m,n);this.$FriendsCenterStickyController0=l;this.$FriendsCenterStickyController1=n||k.parentNode;var o=k.getBoundingClientRect();this.$FriendsCenterStickyController2=o.bottom-o.top;this.$FriendsCenterStickyController3=true;}j.prototype.unstick=function(){"use strict";this.$FriendsCenterStickyController3=false;this.handleScroll();};j.prototype.restick=function(){"use strict";this.$FriendsCenterStickyController3=true;this.handleScroll();};j.prototype.shouldFix=function(){"use strict";if(!this.$FriendsCenterStickyController3)return false;var k=this.$FriendsCenterStickyController1.getBoundingClientRect();return this.$FriendsCenterStickyController0>=k.top&&this.$FriendsCenterStickyController0+this.$FriendsCenterStickyController2<k.bottom;};e.exports=j;});
__d("FriendsCenterStickyHeader",["CSS","DOM","FriendsCenterStickyController","Style","Vector","ge","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('FriendsCenterStickyController'),j=b('Style'),k=b('Vector'),l=b('ge'),m=b('cx'),n=[];function o(p){"use strict";var q=l('blueBar');if(!q)return;var r=j.isFixed(q)?k.getElementDimensions(q).y:0,s=this.getPlaceholder(p.getBoundingClientRect());h.insertAfter(p,s);g.addClass(p,"_5m65");var t=new i(p,r,function(u){g.conditionShow(s,u);g.conditionClass(p,'stuck',u);}.bind(this));t.start();n[p.id]=t;}o.prototype.getPlaceholder=function(p){"use strict";var q=h.create('div');g.hide(q);j.set(q,'height',(p.bottom-p.top)+'px');j.set(q,'width',(p.right-p.left)+'px');return q;};o.stopSticky=function(p){"use strict";p&&(p.id in n)&&n[p.id].unstick();};o.startSticky=function(p){"use strict";p&&(p.id in n)&&n[p.id].restick();};e.exports=o;});
__d("FriendBrowserCheckboxController",["Arbiter","AsyncRequest","CSS","DOM","Event","Form","FriendsCenterStickyHeader","OnVisible","$","bind","copyProperties","csx","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Form'),m=b('FriendsCenterStickyHeader'),n=b('OnVisible'),o=b('$'),p=b('bind'),q=b('copyProperties'),r=b('csx'),s=b('ge');function t(){}q(t,{instances:{},getInstance:function(u){return this.instances[u];}});q(t.prototype,{init:function(u,v,w,x){t.instances[u]=this;this._id=u;this._simplified=w;this._infiniteScroll=x;this._form=v;this._contentGrid=j.find(v,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=j.find(v,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=j.find(v,'.friendBrowserCheckboxResults');this._contentPager=j.find(v,'.friendBrowserCheckboxContentPager');this._standaloneFilters=null;this._searchStarted=false;this._stickyHeader=null;g.subscribe('friend-browser/name-change',this.getNew.bind(this,false));this.numGetNewRequests=0;this.queuedRequests={};k.listen(this._form,'submit',this.onFormSubmit.bind(this));},addTypeahead:function(u,v){u.subscribe('select',this.onHubSelect.bind(this,u,v));if(this._simplified)u.subscribe('unselect',this.onHubSelect.bind(this,u,v));},setStandaloneFilters:function(u){if(u){this._standaloneFilters=j.scry(document.body,'.friendBrowserCheckboxFilters')[0];this._stickyHeader=j.scry(o('fbSearchResultsBox'),"._5m65")[0];var v=o('doneSearchButton');v.onclick=function(){this._searchStarted=false;j.scry(document.body,"._5n-u").forEach(function(w){i.show(w);});i.hide(v);window.scrollTo(0,0);m.startSticky(this._stickyHeader);}.bind(this);}return this;},onFormSubmit:function(){this.getNew(true);return false;},addSelector:function(u){u.subscribe('change',this.getNew.bind(this,false));},onHubSelect:function(u,v,event,w){if(this._simplified){this.getNew(true);return;}if(!((event=='select')&&w.selected))return;var x=this.buildNewCheckbox(v,w.selected.text,w.selected.uid),y=j.find(this._standaloneFilters||this._form,'.checkboxes_'+v);j.appendContent(y.firstChild,x);var z=j.scry(u.getElement(),'input[type="button"]');if(z&&z[0])z[0].click();this.getNew(true);},buildNewCheckbox:function(u,v,w){var x=u+'_ids_'+w,y=u+'_ids[]',z=j.create('input',{id:x,type:'checkbox',value:w,name:y,checked:true});k.listen(z,'click',p(this,'getNew',false));var aa=j.create('td',null,z);i.addClass(aa,'vTop');i.addClass(aa,'hLeft');var ba=j.create('label',null,v),ca=j.create('td',null,ba);i.addClass(ca,'vMid');i.addClass(ca,'hLeft');var da=j.create('tr');da.appendChild(aa);da.appendChild(ca);return da;},showMore:function(){var u=j.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!u)return false;if(i.hasClass(u,'async_saving'))return false;var v=this.numGetNewRequests,w=this.getFormData();w.show_more=true;var x=new h().setURI('/ajax/growth/friend_browser/checkbox.php').setData(w).setHandler(p(this,function(y){this.showMoreHandler(y,v);})).setStatusElement(u).send();},showMoreHandler:function(u,v){if(v==this.numGetNewRequests){var w=u.payload;j.appendContent(this._contentGrid,w.results);this.updatePagerAndExtraData(w.pager,w.extra_data);}},getFormData:function(){var u=l.serialize(this._form);if(this._standaloneFilters){var v=l.serialize(this._standaloneFilters);for(var w in v)u[w]=v[w];}return u;},getNew:function(u){this.numGetNewRequests++;var v=this.numGetNewRequests;i.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(s('friendBrowserCI'))i.addClass(o('friendBrowserCI'),'friendBrowserCheckboxContentOnload');this.startStandaloneSearch();i.show(this._loadingIndicator);var w=this.getFormData();w.used_typeahead=u;new h().setURI('/ajax/growth/friend_browser/checkbox.php').setData(w).setHandler(p(this,function(x){this.getNewHandler(x,v);})).send();},getNewHandler:function(u,v){if(v==this.numGetNewRequests){var w=u.payload;j.setContent(this._contentGrid,w.results);i.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(s('friendBrowserCI'))i.hide(o('friendBrowserCI'));i.hide(this._loadingIndicator);this.updatePagerAndExtraData(w.pager,w.extra_data);}},startStandaloneSearch:function(){if(!this._standaloneFilters)return;window.scrollTo(0,0);if(this._searchStarted)return;this._searchStarted=true;i.show(o('fbSearchResultsBox'));j.scry(document.body,"._5n-u").forEach(function(u){i.hide(u);});i.show(o('doneSearchButton'));m.stopSticky(this._stickyHeader);},updatePagerAndExtraData:function(u,v){j.setContent(this._contentPager,u);if(this._infiniteScroll)this.setupOnVisible();j.replace(this._form.elements.extra_data,v);},setupOnVisible:function(){var u=j.scry(this._contentPager,'.friendBrowserMorePager')[0];if(u&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new n(u,p(this,'showMore'),false,1000);}}});e.exports=t;});
__d("legacy:friend-browser-checkbox-js",["FriendBrowserCheckboxController"],function(a,b,c,d){a.FriendBrowserCheckboxController=b('FriendBrowserCheckboxController');},3);
__d("FacebarResultStoreUtils",[],function(a,b,c,d,e,f){var g={processEntityResult:function(h,i,j,k){var l={semantic:i.toString(),structure:[{type:'ent:'+h,text:j,uid:i}],type:h,cost:k,cache_id_length:0};l.tuid=JSON.stringify({semantic:l.semantic,structure:l.structure});return l;},getRawTextFromStructured:function(h){var i='';h.forEach(function(j,k){i+=j.getText();});return i;}};e.exports=g;});
__d("HashtagSearchResultUtils",["FacebarResultStoreUtils","HashtagParser","HashtagSearchResultConfig","URI"],function(a,b,c,d,e,f){var g=b('FacebarResultStoreUtils'),h=b('HashtagParser'),i=b('HashtagSearchResultConfig'),j=b('URI'),k={getHashtagFromQuery:function(l){var m=h.parse(l);if(m&&m.length===1&&m[0].offset===0)return m[0].tag;return false;},makeTypeaheadResult:function(l){return {category:'Hashtag',path:j('/hashtag/'+l).toString(),photo:i.image_url,rankType:null,replace_results:i.boost_result?true:false,scaled_score:1,score:0,text:'#'+l,type:'hashtag_exact',uid:'hashtag:'+l};},makeFacebarEntry:function(l){return {category:'Hashtag',path:j('/hashtag/'+l).toString(),photo:i.image_url,replace_results:i.boost_result?true:false,text:'#'+l,type:'hashtag_exact',uid:'hashtag:'+l};},makeFacebarResult:function(l){var m=g.processEntityResult('hashtag_exact','hashtag:'+l,'#'+l,i.hashtag_cost);m.parse={display:[{type:'ent:hashtag_exact',uid:'hashtag:'+l}],remTokens:[],suffix:''};m.tags={hashtag:'hashtag'};return m;}};e.exports=k;});
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('DOM'),j=b('CSS'),k=b('Focus'),l=b('Input'),m=b('copyProperties'),n=400;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t,u){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));if(u==null||u.focusSearchBox==null||u.focusSearchBox)k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;});
__d("RequestsJewel",["Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","Cookie","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","shield","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ChannelConstants'),k=b('Cookie'),l=b('CSS'),m=b('DOM'),n=b('Event'),o=b('FriendBrowserCheckboxController'),p=b('LinkController'),q=b('Parent'),r=b('ScrollableArea'),s=b('Vector'),t=b('copyProperties'),u=b('ge'),v=b('shield'),w=b('tx');function x(y,z,aa){if(y)this.init(y,z,aa);}t(x,{instance:null,getInstance:function(){return this.instance;}});t(x.prototype,{init:function(y,z,aa){x.instance=this;this.countNew=0;this.jewel=y;this.jewelFlyoutCase=y.getRoot();this.jewelFlyout=u('fbRequestsFlyout');this.newCountSpan=u('newRequestCount');this.folder=z;this.doNewMarkRead=aa;this.openTimestamp=0;this._requestList={};this._egoData={};this._requestCount=0;this.egoPredictedCount=0;this.pendingCount=0;this.shouldLogEgoClick=false;this.shouldClearPredictionAssocOnClick=false;var ba=u('requestsMarkReadButton');if(ba)n.listen(ba,'click',v(this._markRead,this));this.jewel.subscribe('marked-seen',v(this._markSeenCallback,this));this.jewel.subscribe('closed',v(this._clearNewItems,this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));p.registerHandler(this._handleLink.bind(this));g.subscribe(j.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));g.subscribe(j.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));g.subscribe(j.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));g.subscribe('jewel/ego_predicted_count',function(da,ea){this.egoPredictedCount=ea.ego_predicted_count;this.pendingCount=ea.pending_count;this.egoUnseenTimestamp=ea.unseen_timestamp;this.shouldLogEgoClick=ea.should_log_ego_click;this.actionContext=ea.action_context;}.bind(this));n.listen(this.jewelFlyout,'submit',function(da){var ea=q.byClass(da.getTarget(),'objectListItem');if(ea){l.removeClass(ea,'jewelItemNew');l.addClass(ea,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));var ca=m.find(u('fbRequestsJewel'),'a[rel="toggle"]');n.listen(ca,'focus',function(da){var ea=k.get('a11y');if(ea){ea=JSON.parse(ea);if(ea&&ea.kb){ea.kb++;if(ea.kb===10)new i('/ajax/keyboardusers').send();}else{ea={};ea.kb=1;ea.hcm='false';}}k.set('a11y',JSON.stringify(ea));}.bind(this));this.setupScroll();return this;},setupScroll:function(){var y=m.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(y){this._scrollableWrap=y;this._lastLinkPosition=0;this._scrollListener=n.listen(y,'scroll',this._handleScroll.bind(this),n.Priority._BUBBLE);}},fromDom:function(){m.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(y){var z=y.getAttribute('id');if(z){var aa=u(z+'_status'),ba=this._parseIDToInts(z),ca=aa.getAttribute('data-ego');if(ba.requester){this._requestList[ba.requester]=z;if(ca)this._egoData[ca]=ca;}++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(y){var z=y.match(/^(\d+)_(\d+)/);return (z)?{requester:z[1],type:z[2]}:undefined;},_parseIDToInts:function(y){var z=y?this._parseID(y):undefined,aa;if(z&&z.requester){aa=parseInt(z.requester,10);if(isNaN(aa))aa=undefined;}var ba;if(z&&z.type){ba=parseInt(z.type,10);if(isNaN(ba))ba=undefined;}return {requester:aa,type:ba};},_handleLink:function(y,event){var z=q.byClass(y,'jewelItemNew');if(z&&q.byClass(z,'fbRequestList')&&q.byClass(z,'beeperEnabled')){var aa=this._parseID(z.id);aa&&this._markSeenCallback(aa.requester,aa.type);g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});l.removeClass(z,'jewelItemNew');}return true;},_handleScroll:function(){var y=m.scry(this._scrollableWrap,'.uiMorePager');if(!y||(u('fbRequestsJewelManualPager')&&y.length<2))return;var z=y.pop();if(z){var aa=s.getElementPosition(z,'viewport').y;if(aa>0)l.addClass(q.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var ba=m.find(z,'a');if(!ba)return;var ca=s.getElementPosition(ba,'viewport').y;if(ca==this._lastLinkPosition)return;var da=s.getElementPosition(this._scrollableWrap,'viewport').y+s.getElementDimensions(this._scrollableWrap).y;if(ca-300<da&&ca>0){this._lastLinkPosition=ca;var ea=ba.getAttribute('ajaxify');if(ea){new h(ea).setRelativeTo(ba).setStatusElement(q.byClass(ba,'stat_elem')).send();}else o.getInstance('jewel').showMore();}}},_addRequest:function(y,z){if(!z)return;var aa=z.obj.from,ba=z.obj.suggester,ca=this._parseIDToInts(this._requestList[aa]).type,da=ca===19&&!ba;if(!da&&(ca||this.jewel.isOpen()))return;if(u('fbRequestsJewelLoading')){new h().setURI('/ajax/requests/loader/').send();}else{var ea=this._onMarkupCallback.bind(this,aa,!!ba),fa={from:aa};if(ba)fa.suggester=ba;new h().setURI('/ajax/friends/jewel/request_markup').setData(fa).setHandler(ea).send();}},_onMarkupCallback:function(y,z,aa){var ba=aa.getPayload();if(!ba)return;var ca=this._requestList[y],da=this._parseIDToInts(ca).type;if(da===19&&!z){var ea=ca&&u(ca);ea&&m.replace(ea,ba.markup);}else{var fa=m.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!fa)return;m.prependContent(fa,ba.markup);var ga={jewel:'requests',count:++this.countNew};g.inform('jewel/count-updated',ga);++this._requestCount;this._conditionShowEmptyMessage();}this._requestList[y]=ba.item_id;},_removeOldRequest:function(y,z){if(!z||this.jewel.isOpen()||u('fbRequestsJewelLoading')!==null)return;var aa=this._requestList[z.obj.from],ba=aa&&u(aa);if(ba){l.hasClass(ba,'jewelItemNew')&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!l.hasClass(ba,'jewelItemResponded')){m.remove(ba);delete this._requestList[z.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var y=u('fbRequestsJewelManualPager');if(y){var z=m.scry(y,'.uiMorePagerPrimary')[0];if(z.style&&z.style.display!='none')setTimeout(function(){z.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(y,z){var aa=m.scry(this.jewelFlyout,'li');new i('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:aa[0].id}).send();new h().setURI('/ajax/friends/jewel/predicted_count_logging').setData({ego_predicted_count:this.egoPredictedCount,pending_count:this.pendingCount,unseen_timestamp:this.egoUnseenTimestamp,action_context:this.actionContext,should_log_ego_click:this.shouldLogEgoClick}).send();var ba=typeof y!='undefined'&&typeof z!='undefined'?{requester:y,type:z}:{};this.doNewMarkRead&&new i('/ajax/requests/mark_read/',ba).send();},_markSeenFromMessage:function(y,z){g.inform('jewel/count-updated',{jewel:'requests',count:0});},_removeRequest:function(y,z){var aa=z.obj.item_id;if(aa){var ba=u(aa),ca=ba&&l.hasClass(ba,'jewelItemNew');ba?m.remove(ba):ca&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(y,z){m.scry(this.jewel.root,'li.jewelItemNew').forEach(function(aa){l.removeClass(aa,'jewelItemNew');});},_updateCount:function(y,z){this.countNew=z.count;l.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);l.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var aa=this.countNew==1?w._("{num} NEW REQUEST",{num:this.countNew}):w._("{num} NEW REQUESTS",{num:this.countNew});m.setContent(this.newCountSpan,aa);}},_conditionShowEmptyMessage:function(){m.scry(this.jewelFlyout,'li.empty').forEach(function(y){l.conditionShow(y,this._requestCount<=0);}.bind(this));},_openHandler:function(){var y=m.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(u('fbRequestsJewelLoading')){var z=Date.now();if(this.openTimestamp+5000<z){this.openTimestamp=z;new h().setURI('/ajax/requests/loader/').setData({log_impressions:true}).send();}}else{var aa=Object.keys(this._requestList);if(aa.length>0){new h().setURI('/friends/requests/log_impressions').setData({ids:aa.join(','),ref:'jewel'}).send();var ba=Object.keys(this._egoData);if(ba.length>0)new h().setURI('/growth/jewel/impression_logging.php').setData({egodata:ba}).send();}}y&&r.poke(y);}});e.exports=x;});
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('TabIsolation'),o=b('Toggler'),p=b('copyProperties'),q=b('emptyFunction'),r=b('reportData'),s=b('setTimeoutAcrossTransitions'),t=function(u,v){u&&v&&this.init(u,v);};p(t,{_instancesByName:{},_resizeListener:null});p(t.prototype,i,{init:function(u,v){this.name=v.name;this.root=u;this.countNew=0;this.initialCount=0;this.escHandler=null;t._instancesByName[this.name]=this;var w=k.find(u,'.jewelFlyout'),x=new n(w);o.createInstance(w).setSticky(false);o.listen('show',this.root,function(y){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});x.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(y,z){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});x.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(y,z){z.jewel==this.name&&this.update(z);}.bind(this));h.subscribe('jewel/count-initial',function(y,z){z.jewel==this.name&&this.setInitial(z);}.bind(this));h.subscribe('jewel/reset',function(y,z){z.jewel==this.name&&this.reset();}.bind(this));t._resizeListener=t._resizeListener||(function(){var y=null;return g.listen(window,'resize',function(){clearTimeout(y);y=s(h.inform.bind(h,'jewel/resize'),100);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(u){var v=k.find(this.root,'ul.jewelItemList');k.setContent(v,l(u));},update:function(u){this.countNew=u.count;var v=k.find(this.root,'span.jewelCount span');k.setContent(v,this.countNew);var w=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',w);if(w){var x=(''+this.countNew).length;j.conditionClass(this.root,'hasCountSmall',x===1);j.conditionClass(this.root,'hasCountMedium',x===2);j.conditionClass(this.root,'hasCountLarge',x>2);}this.inform('updated',u);},setInitial:function(u){this.initialCount=u;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(u){if(u.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=t;});
__d("ModalMask",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=null,i=0,j={show:function(){i++;if(!h){h=g.create('div',{id:'modalMaskOverlay'});g.appendContent(document.body,h);}},hide:function(){if(i){i--;if(!i&&h){g.remove(h);h=null;}}}};e.exports=j;});
__d("MercuryJewelCountControl",["Arbiter","DOM","MercuryThreadlistConstants","copyProperties","shield","tx","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('MercuryThreadlistConstants'),j=b('copyProperties'),k=b('shield'),l=b('tx'),m=b('MercuryServerRequests').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryUnseenState').get(),p,q,r,s=function(u){if(u||r.isOpen())o.markAsSeen();},t=function(u,v){p=u;q=h.find(p,'#mercurymessagesCountValue');r=v;this.render();m.subscribe('model-update-completed',function(w,x){s(false);});n.subscribe('unseen-updated',this.render.bind(this));r.subscribe('marked-seen',k(s,this,true));};j(t.prototype,{render:function(){var u='';if(o.exceedsMaxCount()){u=l._("{count}+",{count:i.MAX_UNSEEN_COUNT});}else u=o.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:u},g.BEHAVIOR_STATE);}});e.exports=t;});
__d("MercuryJewelThreadlistControl",["ArbiterMixin","ChatOpenTab","MercuryConfig","CSS","DOM","Event","JSLogger","JSXDOM","MercuryAPIArgsSource","MercuryIDs","MercuryThreadlistConstants","MessagingTag","MercuryOrderedThreadlist","Parent","MercuryPresence","MercuryJewelTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","Tooltip","MercuryUnreadState","copyProperties","csx","cx","throttle","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatOpenTab'),i=b('MercuryConfig'),j=b('CSS'),k=b('DOM'),l=b('Event'),m=b('JSLogger'),n=b('JSXDOM'),o=b('MercuryAPIArgsSource'),p=b('MercuryIDs'),q=b('MercuryThreadlistConstants'),r=b('MessagingTag'),s=b('MercuryOrderedThreadlist').get(),t=b('Parent'),u=b('MercuryPresence'),v=b('MercuryJewelTemplates'),w=b('MercuryThreadInformer').get(),x=b('MercuryThreadMetadataRenderer').get(),y=b('MercuryThreads').get(),z=b('Tooltip'),aa=b('MercuryUnreadState').get(),ba=b('copyProperties'),ca=b('csx'),da=b('cx'),ea=b('throttle'),fa=b('tx'),ga=m.create('mercury_jewel');function ha(pa,qa){this._contentArea=k.scry(pa,'.scrollable')[0]||pa;this._contentElement=k.find(this._contentArea,'.jewelContent');this._loadingElement=k.find(this._contentArea,'.jewelLoading');this._loadMoreButton=k.find(this._contentArea,"._8y5");this._loadMoreLink=k.find(this._contentArea,"a._8y6");this._currentFolder=r.INBOX;this._jewelFolderLinks=[];this._jewelFolderLinks[r.INBOX]=k.find(qa,"._1sde");this._jewelFolderLinks[r.OTHER]=k.find(qa,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[r.INBOX]=k.find(qa,"._1sdg");this._jewelFolderCounts[r.OTHER]=k.find(qa,"._1sdh");ma.bind(this)();l.listen(this._jewelFolderLinks[r.INBOX],'click',la.bind(this,r.INBOX));l.listen(this._jewelFolderLinks[r.OTHER],'click',la.bind(this,r.OTHER));this._curCount=[];this._curCount[r.INBOX]=q.JEWEL_THREAD_COUNT+1;this._curCount[r.OTHER]=q.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[r.INBOX]=false;this._isFolderLoaded[r.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[r.INBOX]=false;this._folderIsLoading[r.OTHER]=false;w.subscribe('threadlist-updated',this.render.bind(this));w.subscribe('unread-updated',ma.bind(this));this.render();ga.bump('opened_threadlist_'+this._currentFolder);l.listen(this._contentArea,'scroll',ea(ia,50,this));l.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}ba(ha,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});ba(ha.prototype,g);ba(ha.prototype,{render:function(){k.empty(this._contentElement);j.show(this._loadingElement);j.hide(this._loadMoreButton);var pa=k.create('div');k.appendContent(this._contentElement,pa);s.getThreadlist(q.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,pa),true);},renderThreads:function(pa,qa){this.inform(ha.EVENT_THREADS_LOADED);if(qa.length){qa.forEach(function(ra){var sa=v[':fb:mercury:jewel:threadlist-row'].build();y.getThreadMeta(ra,function(ta){x.renderCoreThreadlist(ta,sa,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));k.appendContent(pa,sa.getRoot());}.bind(this));}else k.setContent(this._contentElement,this.renderEmptyThreadlist());j.hide(this._loadingElement);j.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(ha.EVENT_THREADS_RENDERED);},renderSingleThread:function(pa,qa){var ra=qa.unread_count>0;if(ra)j.addClass(pa.getRoot(),'jewelItemNew');var sa=n.div({className:"x_div"}),ta=n.div({className:"_5c9q"}),ua="Mark as Unread";if(ra)ua="Mark as Read";z.set(ta,ua,'above','right');l.listen(ta,'click',function(event){y.changeThreadReadStatus(qa.thread_id,qa.unread_count>0);return false;});sa.appendChild(ta);pa.getNode('link').appendChild(sa);if(h.canOpenTab()){var va=pa.getNode('presenceIndicator'),wa=qa.is_canonical&&qa.canonical_fbid?qa.canonical_fbid:qa.thread_id;oa(wa,va);}x.renderWebMessengerLink(qa.thread_id,pa.getNode('link'),null,this._currentFolder);if(i.MessagesJewelOpenInChat)l.listen(pa.getRoot(),'click',function(xa){var ya=h.canOpenTab()&&!xa.isDefaultRequested();if(ya&&xa.prevent())h.openThread(qa.thread_id,'jewel');});l.listen(pa.getRoot(),'mouseover',function(event){var xa=pa.getRoot();if(!t.byClass(xa,'notifNegativeBase'))j.addClass(xa,'selected');});l.listen(pa.getRoot(),'mouseout',function(event){j.removeClass(pa.getRoot(),'selected');});},renderMoreThreads:function(){j.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var pa=this._curCount[this._currentFolder]+q.JEWEL_MORE_COUNT;s.getThreadlist(q.RECENT_THREAD_OFFSET,pa+1,this._currentFolder,ka.bind(this,pa,this._currentFolder),true,o.JEWEL);},renderEmptyThreadlist:function(){return k.create('li',{className:'empty'},"No messages");}});function ia(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&ja.bind(this)())this.renderMoreThreads();}function ja(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function ka(pa,qa,ra){this._curCount[qa]=pa;if(!this._isFolderLoaded[qa]&&ra.length<this._curCount[qa]+1)this._isFolderLoaded[qa]=true;this._folderIsLoading[qa]=false;j.removeClass(this._loadMoreButton,'async_saving');this.render();}function la(pa){if(this._currentFolder!=pa){ga.bump('opened_threadlist_'+pa);j.addClass(this._jewelFolderLinks[pa],"_1sdd");j.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=pa;this.render();}}function ma(){na.bind(this)(r.INBOX);na.bind(this)(r.OTHER);}function na(pa){var qa;if(aa.exceedsMaxCount(pa)){qa=q.MAX_UNREAD_COUNT;}else qa=aa.getUnreadCount(pa);var ra=this._jewelFolderCounts[pa];if(qa>0){if(qa==q.MAX_UNREAD_COUNT)qa+='+';k.setContent(ra,fa._("({unread_count})",{unread_count:qa}));}else k.setContent(ra,'');}function oa(pa,qa){var ra=p.isValid(pa)&&p.isMultichat(pa);if(ra){j.addClass(qa,'groupThread');}else u.updateOnPresenceChanges(pa,qa);}e.exports=ha;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests').get(),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("RenderManager",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){"use strict";this._isDirty=false;this._obj=i;}h.prototype.dirty=function(){"use strict";if(!this._isDirty){this._isDirty=true;setTimeout(this._doPaint.bind(this),0);}};h.prototype._doPaint=function(){"use strict";this._isDirty=false;this._obj.paint();};e.exports=h;});
__d("CounterDisplay",["Arbiter","CSS","DOM","RenderManager","Run","$","copyProperties","removeFromArray"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('RenderManager'),k=b('Run'),l=b('$'),m=b('copyProperties'),n=b('removeFromArray');function o(p,q,r,s,t,u){m(this,{_name:p,_valueNode:l(q),_wrapperNode:l(r)||null,_statusClass:t,_rm:new j(this),_arbiterSubscription:null,_count:0});var v=this._valueNode.firstChild;if(v){var w=parseInt(v.nodeValue,10);if(!isNaN(w))this._count=w;}this._statusNode=s?l(s):null;this._subscribeAll();o.instances.push(this);if(!u)k.onLeave(this._destroy.bind(this),true);}m(o,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(p,q){g.inform(o.EVENT_TYPE_ADJUST+'/'+p,q);},setCount:function(p,q){g.inform(o.EVENT_TYPE_UPDATE+'/'+p,q);}});m(o.prototype,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){this._arbiterSubscription.unsubscribe();delete this._arbiterSubscription;}n(o.instances,this);},adjustCount:function(p){this._count=Math.max(0,this._count+p);this._rm.dirty();return this;},setCount:function(p){this._count=Math.max(0,p);this._rm.dirty();return this;},paint:function(){i.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)h.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)h.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var p=[o.EVENT_TYPE_ADJUST+'/'+this._name,o.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=g.subscribe(p,this._onInform.bind(this),g.SUBSCRIBE_NEW);},_onInform:function(p,q){q=parseInt(q);if(isNaN(q))return;if(p.indexOf(o.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(q);}else if(p.indexOf(o.EVENT_TYPE_UPDATE)!=-1){this.setCount(q);}else return;return;}});e.exports=o;});
__d("MessagingEvents",["Arbiter","ChannelConstants","arrayContains","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('arrayContains'),j=b('copyProperties'),k=b('isEmpty'),l={},m=new g();function n(o){if(!k(l))return;for(var p in o)m.inform('count/'+p,o[p]);}m.subscribe('mark-as-read',function(o,p){(p.tids||p.chat_ids||[]).forEach(function(q){q=''+q;if(!(q in l)){l[q]=true;var r=function(){m.unsubscribe(s);clearTimeout(t);delete l[q];},s=m.subscribe('read',function(u,v){if(i((v.tids||[]),q)||i((v.chat_ids||[]),q))r();}),t=setTimeout(r,60000);}});});g.subscribe(h.getArbiterType('messaging'),function(o,p){var q=j({},p.obj),event=q.event||'';delete q.type;delete q.event;m.inform(event,q);if('unread_counts' in q){var r=q.unread_counts;n({unread:r.inbox,other_unseen:r.other});}});g.subscribe(h.getArbiterType('inbox'),function(o,p){var q=j(p.obj);delete q.type;n(q);});a.MessagingEvents=e.exports=m;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Keys'),k=b('TabbableElements'),l=b('Toggler'),m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m||h.hasClass(m,w.MENU_HIDDEN))return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);},MENU_HIDDEN:'menu_hidden'};e.exports=w;});
__d("isEmail",[],function(a,b,c,d,e,f){var g=/^[\w!#\$%&'\*\+\/\=\?\^`\{\|\}~\-]+(:?\.[\w!#\$%&`\*\+\/\=\?\^`\{\|\}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i;function h(i){return g.test(i);}e.exports=h;});
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/initialized',o='PagesVoiceBar/switchVoice',p='page_transition',q='pages_voice_bar_sync',r=null,s=null,t=false;function u(aa,ba){new i('/ajax/pages/switch_voice.php').setData(ba).setHandler(function(ca){y();}).send();}function v(){r=null;}function w(aa,ba){if(ba.obj.profile_id&&ba.obj.profile_id==r)y();}function x(aa){h.subscribe(n,aa);}function y(){m.getNextURI().go();}var z={initVoiceBar:function(){if(t)return;s=g('pagesVoiceBarContent');h.subscribe(o,u);h.subscribe(p,v);h.subscribe(k.getArbiterType(q),w);t=true;h.inform(n,null,h.BEHAVIOR_STATE);},update:function(aa,ba){x(function(){r=ba;l.setContent(s,aa);});}};e.exports=z;});
__d("PrivacyLiteFlyout",["Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Event","Parent","PrivacyConst","SelectorDeprecated","Style","Toggler","copyProperties","csx","cx","ge","XPrivacyRemindersDismissControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('Ease'),n=b('Event'),o=b('Parent'),p=b('PrivacyConst'),q=b('SelectorDeprecated'),r=b('Style'),s=b('Toggler'),t=b('copyProperties'),u=b('csx'),v=b('cx'),w=b('ge'),x='PrivacyLiteFlyout/expandingSection',y=b('XPrivacyRemindersDismissControllerURIBuilder'),z={},aa={};function ba(ja,ka,la){var ma=ka?0:ja.offsetHeight;r.set(ja,'height',ma+'px');r.set(ja,'overflow','hidden');k.show(ja);var na=ka?ja.scrollHeight:0,oa=l.getID(ja);z[oa]&&z[oa].stop();z[oa]=new g(ja).to('height',na).ondone(function(){z[oa]=null;r.set(ja,'height','');r.set(ja,'overflow','');na||k.hide(ja);la();}).duration(Math.abs(na-ma)*1.5).ease(m.sineOut).go();}function ca(ja){return new j().setURI(ja).send();}function da(){return ca('/ajax/privacy/privacy_lite/increment_masher_tip_count');}function ea(){return ca('/ajax/privacy/privacy_lite/dismiss_masher_tip');}var fa=null,ga=false,ha=false,ia=t({loadBody:function(){this._loadBody(false);},loadBodyFromMegaphone:function(){this._loadBody(true);},_loadBody:function(ja){if(!ga&&w('fbPrivacyLiteFlyoutLoading')){ga=true;new j('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ja}).send();}},renderBody:function(ja){var ka=w('fbPrivacyLiteFlyoutLoading');if(ka){l.replace(ka,ja);ia.inform('load',null,h.BEHAVIOR_STATE);}},hideCleanup:function(ja){h.inform(x);var ka=l.scry(ja,"._2va0").forEach(function(la){k.removeClass(la,"_2va0");});},registerFlyoutToggler:function(ja,ka){fa=ka;var la=s.createInstance(ja);la.setSticky(false);s.listen(['show','hide'],ka,function(ma){ia.inform(ma);ha=ma==='show';if(!ha){ia.hideCleanup(ja);la.hide();h.inform('layer_hidden',{type:'PrivacyShortcutsFlyout'});}else h.inform('layer_shown',{type:'PrivacyShortcutsFlyout'});});},isFlyoutVisible:function(){return fa&&s.getActive()===fa;},exists:function(){return !!l.scry(document.body,"._59fc")[0];},setFlyoutVisible:function(ja){ja?s.show(fa):s.hide(fa);},showSection:function(ja){var ka=aa[ja],la=ka.chevron,ma=ka.sublist_container;h.inform(x,la);if(ia.inform('expand',ja)!==false){k.removeClass(la,"_9or");k.addClass(la,"_9os");ba(ma,true,function(){ia.inform('expanded',ja);});}},hideSection:function(ja,ka,la){var ma=aa[ja],na=ma.chevron,oa=ma.sublist_container;if(la===na)return;if(ia.inform('collapse',ja)!==false){k.addClass(na,"_9or");k.removeClass(na,"_9os");ba(oa,false,function(){ia.inform('collapsed',ja);});}},toggleSection:function(ja){var ka=aa[ja].chevron;s.getInstance(ka).hide();if(k.hasClass(ka,"_9or")){ia.showSection(ja);new j('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ja}).send();}else ia.hideSection(ja);},registerSection:function(ja,ka){aa[ja]=ka;h.subscribe(x,ia.hideSection.bind(null,ja));n.listen(ka.section_block,'click',ia.toggleSection.bind(null,ja));},registerInlineHelpOnAudienceChange:function(ja,ka,la,ma){q.subscribe('select',function(na,oa){if(oa.selector!=ja)return;var pa=l.find(ka,"._9o_"),qa=l.find(ka,"._2v9_");if(ma){var ra=l.find(ka,"._5n9w"),sa=(oa.value==p.BaseValue.EVERYONE);k.conditionShow(ra,sa);k.conditionShow(pa,!sa);if(ra&&sa){var ta=(new y()).setString('type','delta_everyone').setBool('log_plite',true).getURI();new j(ta).send();}}else k.show(pa);k.hide(qa);if(la)new j('/ajax/privacy/privacy_lite/kill_intro').send();});},registerInlineHelpXOutOnClick:function(ja,ka,la){n.listen(ja,'click',function(){k.addClass(ka,"_9p0");});},registerBlockUnhideOnFocus:function(ja,ka){n.listen(ja,'focus',k.show.bind(null,ka));},registerMessageFilterSettingOnClick:function(ja,ka){var la=l.find(ja,"._fv0");n.listen(ja,'click',function(){if(la.checked)new j('/ajax/mercury/change_filtering_type.php').setData({filtering_type:ka,source:'privacy_lite'}).send();});},registerMasher:function(ja,ka){var la=false;h.subscribe(x,function(ma,na){var oa=true;if(na)oa=!!l.scry(o.byTag(na,'li'),"._571t").length;if(la||!oa)return;la=!!(da());});n.listen(ka,'click',function(){l.remove(ja);ea();});}},i);e.exports=ia;});
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ContextualHelpSearchController'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w,{focusSearchBox:false});q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;});
__d("ViewasChromeBar",["Event","Arbiter","AsyncRequest","CSS","DOM","Focus","ModalMask","PageTransitions","Parent","cx","csx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('ModalMask'),n=b('PageTransitions'),o=b('Parent'),p=b('cx'),q=b('csx'),r='ViewasChromeBar/initialized',s=null,t=false;function u(x){h.subscribe(r,x);}function v(x){j.addClass(x,"_7g7");var y=k.find(x,"._7g0");l.set(k.find(y,'.textInput'));}var w={initChromeBar:function(x){if(t)return;s=x;t=true;h.inform(r,null,h.BEHAVIOR_STATE);},update:function(x,y){u(function(){k.setContent(s,x);if(y)new i('/ajax/privacy/glasgow/viewas_bar_flyout_open').send();});},registerSpecificModeOnClick:function(x){g.listen(x,'click',v.bind(null,o.byClass(x,"_7f-")));},registerFlyoutModalMask:function(){m.show();n.registerHandler(m.hide,10);}};e.exports=w;});
__d("BingScalingCommon",[],function(a,b,c,d,e,f){var g={integrateWebsuggestions:function(h,i,j,k,l){var m=[],n=i?m:[],o=[],p=0,q=0,r=j;k=Math.floor(j*k);for(var s=0;s<h.length;s++){var t=h[s];if(t.type==='websuggestion'&&!t.isSeeMore){if((r>0&&p<k)||(p>0&&p<l)){n.push(t);p++;r--;}else if(r>0)o.push(t);}else{if(r<=0&&!i)continue;m.push(t);q++;r--;}}if(r>0&&o.length>0)n=n.concat(o.slice(0,r));if(!i)return m.concat(n);return n;}};e.exports=g;});
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","DataSource","HashtagSearchResultUtils","copyProperties","createArrayFrom","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('DataSource'),k=b('HashtagSearchResultUtils'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('BingScalingCommon');for(var o in j)if(j.hasOwnProperty(o))q[o]=j[o];var p=j===null?null:j.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=j;function q(r){"use strict";this._token=r.token||'';this._lazyonload=r.lazyonload===false?false:true;this._extraTypes=r.extraTypes;this._buckets=r.buckets;this._noMultiFetch=r.noMultiFetch||false;this._maxWebSuggToCountFetchMore=r.maxWebSuggToCountFetchMore||0;var s=r.maxResults||8;j.call(this,r);this._numResults={min:3,max:s};this.recordingRoute=r.recordingRoute||'non_banzai';this._enabledHashtag=r.enabledHashtag||false;this.logBackendQueriesWindow=r.logBackendQueriesWindow||25;this._minWebSugg=r.minWebSugg||2;this._queryToWebSuggState={};this._genTime=r.genTime;}q.prototype.init=function(){"use strict";p.init.call(this);this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));this.complexChars=new RegExp('[\uFF66-\uFFDD\u4E00-\u9FCC\u3400-\u4DBF]');};q.prototype.dirty=function(){"use strict";p.dirty.call(this);this._fetchOnUseRequests=[];};q.prototype.asyncErrorHandler=function(r){"use strict";if(window.Dialog&&window.Dialog.getCurrent()==null&&r.getError()==1400003)i.verboseErrorHandler(r);};q.prototype.fetch=function(r,s,t){"use strict";t=t||{};t.fetch_start=Date.now();p.fetch.call(this,r,s,t);};q.prototype.fetchHandler=function(r,s){"use strict";var t=r.getPayload(),u=l({fetch_end:Date.now()},s),v=u.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:r});if(s.type=='lean'){this._leanPayload=t;this._processLean();}else{if(t.coeff2_ts)u.coeff2_ts=t.coeff2_ts;var w={limit:typeof t.webSuggLimit!=='undefined'?t.webSuggLimit:6,showOnTop:typeof t.webSuggOnTop!=='undefined'?t.webSuggOnTop:false};this._queryToWebSuggState[s.value]=w;p.fetchHandler.call(this,r,s);if(s.bootstrap&&!r.getRequest().getData().no_cache)u.browserCacheHit=(t.timestamp<this._genTime);if(s.bootstrap&&!t.no_data&&this._bootstrapRequestsPending>0){s.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(t.no_data||t.stale||t.token!==this._token){var x=l({},r.getRequest().getData());if(x.lazy){delete x.lazy;x.token=this._token;this._fetchOnUse(x,s);}}}this.inform('endpointStats',u,v);if(s&&!!s.value)this.inform('completeFetch',{response:r,stats:u});};q.prototype.respond=function(r,s,t){"use strict";this.inform('respondValidUids',s);this.inform('reorderResults',s);var u=this.buildData(s,r);u.forEach(function(v,w){v.origIndex=w;});this.inform('respond',{value:r,results:u,isAsync:!!t});return u;};q.prototype.buildData=function(r,s){"use strict";if(!r||r.length===0)return [];var t=this.getWebSuggState(s),u=t.showOnTop,v=n.integrateWebsuggestions(r.map(this.getEntry.bind(this)),Boolean(u),this._maxResults,t.limit);v.length=Math.min(v.length,this._maxResults);return v;};q.prototype.getWebSuggState=function(r){"use strict";while(r){var s=this._queryToWebSuggState[r];if(typeof s!=='undefined')return s;r=r.slice(0,r.length-1);}return {limit:0,showOnTop:false};};q.prototype._isQueryTooShort=function(r){"use strict";return r.length<this._minQueryLength&&!(this.complexChars&&this.complexChars.test(r));};q.prototype.shouldFetchMoreResults=function(r){"use strict";var s=0,t=0;r.forEach(function(u){if(u.type!=='websuggestion'||t++<this._maxWebSuggToCountFetchMore)s++;}.bind(this));return s<this._maxResults;};q.prototype._bootstrapPostProcess=function(){"use strict";var r={time:Date.now()};this.inform('bootstrapped',r,h.BEHAVIOR_PERSISTENT);this._processLean();};q.prototype._processLean=function(){"use strict";if(this._leanPayload){var r,s=this._leanPayload.entries;for(var t in s){r=this.getEntry(t);r&&(r.index=s[t]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}};q.prototype._updateMaxResults=function(){"use strict";var r=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((r-370)/56)))));};q.prototype._bootstrapFetch=function(r,s){"use strict";var t=l(s,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)t.lazy=1;this.fetch(this.bootstrapEndpoint,t,{bootstrap:true,type:r});++this._bootstrapRequestsPending;};q.prototype._fetchOnUse=function(r,s){"use strict";for(var t in this.bootstrapData)!r.hasOwnProperty(t)&&(r[t]=this.bootstrapData[t]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:r,ctx:s});}else this.fetch(this.bootstrapEndpoint,r,s);};q.prototype._fetchLean=function(){"use strict";var r={no_cache:1};r.options=m(r.options);r.options.push('lean');this._fetchOnUse(r,{type:'lean'});};q.prototype.bootstrap=function(r){"use strict";if(!r){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var s={filter:['event'],no_cache:1};this._fetchOnUse(s,{type:'event'});var t=['app','page','group','friendlist'];t=t.concat(this._extraTypes||[]);if(this._noMultiFetch){t.push('user');this._bootstrapFetch('user',{filter:t});}else{this._bootstrapFetch('other',{filter:t});if(this._buckets){for(var u=0;u<this._buckets.length;++u){var v={filter:['user'],buckets:this._buckets[u]};this._bootstrapFetch('user',v);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;};q.prototype._flushFetchOnUseRequests=function(){"use strict";var r=this._fetchOnUseRequests.length;for(var s=0;s<r;++s){var t=this._fetchOnUseRequests[s];this.fetch(this.bootstrapEndpoint,t.args,t.ctx);}if(r>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];};q.prototype.onLoad=function(r,s){"use strict";this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(r)setTimeout(this.bootstrap.bind(this,s),0);};q.prototype.mergeUids=function(r,s,t,u){"use strict";var v=this.getDynamicHashtagResult(u);if(u&&v&&s.indexOf(v)<=0)s.unshift(v);var w=t[0]?this.getEntry(t[0]):null,x=s[0]?this.getEntry(s[0]):null,y=(w&&w.replace_results)?w:null;y=(!y&&x&&x.replace_results)?x:y;var z=p.mergeUids.call(this,r,s,t,u);if(y){this.inform('backend_topreplace',{});return this.deduplicateByKey([y.uid].concat(z));}return z;};q.prototype.getTextToIndexFromFields=function(r,s){"use strict";var t=[],u=r.tokenVersion==="v2";for(var v=0;v<s.length;++v){if(u&&(s[v]==="text"||s[v]==="alias"))continue;var w=r[s[v]];if(w)t.push(w.join?w.join(' '):w);}return t.join(' ');};q.prototype.getDynamicHashtagResult=function(r){"use strict";if(!r||!this._enabledHashtag)return;var s=k.getHashtagFromQuery(r);if(!s)return;var t='hashtag:'+s,u=this.getEntry(t);if(!u)this.processEntries([k.makeTypeaheadResult(s)],r);return t;};e.exports=q;});
__d("legacy:SearchDataSource",["SearchDataSource"],function(a,b,c,d){a.SearchDataSource=b('SearchDataSource');},3);
__d("SearchTypeaheadCore",["Arbiter","DOM","Event","Input","Parent","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('Event'),j=b('Input'),k=b('Parent'),l=b('TypeaheadCore'),m=b('copyProperties');for(var n in l)if(l.hasOwnProperty(n))p[n]=l[n];var o=l===null?null:l.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=l;function p(q){"use strict";l.call(this,q);}p.prototype.init=function(q,r,s){"use strict";o.init.call(this,q,r,s);var t=k.byTag(s,'form'),u=this.reset.bind(this);g.subscribe('pre_page_transition',function(event,w){var x=/^\/search/,y=x.test(w.from.path),z=x.test(w.to.path);if(y&&!z)setTimeout(u,0);});if(t){var v=h.find(t,'input.search_sid_input');i.listen(t,'submit',function(){if(this.data&&this.data.queryData)v.value=this.data.queryData.sid;setTimeout(u,0);}.bind(this),i.Priority.URGENT);}};p.prototype.select=function(){"use strict";this.reset();this.element.focus();setTimeout((function(){this.element.blur();}).bind(this),0);};p.prototype.handleTab=function(event){"use strict";var q=this.view.getQuerySuggestion(this.value);if(q){j.setValue(this.element,q);this.checkValue();event.kill();}else o.handleTab.call(this,event);};p.prototype.getSearchType=function(){"use strict";return 'regular';};e.exports=p;});
__d("legacy:SearchTypeaheadCore",["SearchTypeaheadCore"],function(a,b,c,d){a.SearchTypeaheadCore=b('SearchTypeaheadCore');},3);
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI","isEmail","fbt"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('ContextualLayerUpdateOnScroll'),j=b('copyProperties'),k=b('DOM'),l=b('goURI'),m=b('MusicConstants'),n=b('MusicEvents'),o=b('tx'),p=b('URI'),q=b('isEmail'),r=b('fbt');for(var s in h)if(h.hasOwnProperty(s))u[s]=h[s];var t=h===null?null:h.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=h;function u(w,x){"use strict";h.call(this,w,x);}u.prototype.initializeLayer=function(){"use strict";t.initializeLayer.call(this);this.layer.setOffsetY(-1);this.layer.enableBehavior(i);};u.prototype.ignoreClick=function(event){"use strict";event.prevent();};u.prototype.render=function(w,x,y){"use strict";if(this._bucketize)x=v(x);var z={results:x,value:w};this.inform('finalResultsReordering',z);return t.render.call(this,w,z.results,y);};u.prototype.disableBucketization=function(){"use strict";this._bucketize=false;};u.prototype.buildBuckets=function(w,x){"use strict";var y=x.length,z=0,aa;for(aa=0;aa<y;++aa)if(x[aa].type=='user')z++;this._redirectToUsersResultsPage=this.showFilterResults&&z===y;this.setWebSuggLoggingParams(w,x);if(this._bucketize)x=t.buildBuckets.call(this,w,x);if(w&&this._shouldShowSeeMore){x.push(this.buildSeeMore(w,y));if(q(w)&&(z<1))x.push(this.buildInvite(w));}return x;};u.prototype.buildSeeMore=function(w,x){"use strict";var y=this.getSeeMoreText(w,x),z=x==1?"Displaying top result":o._("Displaying top {number} results",{number:x}),aa=k.create('li',{className:'calltoaction'},[k.create('a',{href:this.getSeeMoreEndpoint(w),rel:'ignore'},[k.create('span',{className:'text'},[k.create('span',{className:'seeMore'},[y,k.create('span',{className:'arrow'})]),k.create('span',{className:'subtext'},[z])])])]);aa.setAttribute('aria-label',y);return {uid:'search',node:aa,search:true};};u.prototype.getSeeMoreText=function(w,x){"use strict";if(this.showKeywordResultsPage)return r._("Search for {query}",[r.param("query",w)]);if(x<=0)return o._("See results for {query}",{query:w});if(this._redirectToUsersResultsPage)return r._("Filter results for {query}",[r.param("query",w)]);return o._("See more results for {query}",{query:w});};u.prototype.buildInvite=function(w){"use strict";var x=o._("Invite {query} to Facebook",{query:w}),y=k.create('li',{className:'calltoaction'},[k.create('a',{href:this.getInviteEndpoint(w),rel:'ignore'},[k.create('span',{className:'text'},[k.create('span',{className:'invite'},[x])])])]);y.setAttribute('aria-label',x);return {uid:'invite',node:y,search:true};};u.prototype.searchPageQueryData=function(w){"use strict";return j({q:w},this.queryData||{});};u.prototype.searchPageTypeData=function(){"use strict";return this._redirectToUsersResultsPage?{type:"users"}:{};};u.prototype.select=function(w){"use strict";var x=this.index,y=this.results[x];if(!y||y.type=='header')return;var z=this.items[x],aa=k.scry(z,'a')[0];if(y.song){if(aa)n.inform(m.MUSIC_BUTTON.ACTIVATE,aa);w&&this.inform('highlight',{index:x,selected:y});}else{t.select.call(this,w);if(aa&&aa.href)if(aa.target=='_blank'){window.open(aa.href);}else l(aa.href);}};u.prototype.setSid=function(w){"use strict";this.queryData.tas=w;};u.prototype.getSeeMoreEndpoint=function(w){"use strict";return p(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(w)).addQueryData(this.searchPageTypeData()).toString();};u.prototype.getInviteEndpoint=function(w){"use strict";return p('/invite.php').addQueryData({email_list:w});};u.prototype.show=function(){"use strict";if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});t.show.call(this);}};u.prototype.hide=function(){"use strict";if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});t.hide.call(this);}};u.prototype.getQuerySuggestion=function(w){"use strict";var x=this.results[this.index],y=x&&x.type!='header'?x.text.toLowerCase():'';return y==w.toLowerCase()?'':y;};u.prototype.setWebSuggLoggingParams=function(w,x){"use strict";var y=0,z=0;for(var aa=0;aa<x.length;aa++)if(x[aa].type==='websuggestion'){if(z===0)z=aa+1;var ba='FR'+(aa-y)+'AS'+y,ca=aa+1;x[aa].path+='&wssk='+ba+'&wssp='+ca+'&wspq='+encodeURIComponent(w);x[aa].path+='&wssrc='+x[aa].websuggestion_source;y++;}var da='&wssc='+x.length+'-'+w.length+'&wsbp='+y+'-'+z;for(aa=0;aa<x.length;aa++)if(x[aa].type==='websuggestion')x[aa].path+=da;};function v(w){var x,y,z,aa,ba=[],ca={};y=w.length;for(x=0;x<y;x++){z=w[x];aa=z.render_type||z.type;if(!ca.hasOwnProperty(aa)){ca[aa]=ba.length;ba.push([]);}ba[ca[aa]].push(z);}var da=[];y=ba.length;for(x=0;x<y;++x){z=ba[x][0];aa=z.render_type||z.type;da=da.concat(ba[x]);}return da;}j(u.prototype,{_shouldShowSeeMore:true,_bucketize:true,queryData:{init:'quick'}});e.exports=u;});
__d("legacy:SearchTypeaheadView",["SearchTypeaheadView"],function(a,b,c,d){a.SearchTypeaheadView=b('SearchTypeaheadView');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("SearchTypeaheadRecorder",["AsyncRequest","Banzai","CurrentUser","Event","Keys","ScubaSample","TokenizeUtil","Vector","clickRefAction","copyProperties","ge","userAction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Banzai'),i=b('CurrentUser'),j=b('Event'),k=b('Keys'),l=b('ScubaSample'),m=b('TokenizeUtil'),n=b('Vector'),o=b('clickRefAction'),p=b('copyProperties'),q=b('ge'),r=b('userAction');function s(u){"use strict";this.init(u);this.initEvents();}s.prototype.init=function(u){"use strict";this.core=u.getCore();this.data=u.getData();this.view=u.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];this.performanceTimings={};var v=q('search_first_focus');this.initStartTime=v&&v.value;this.bootstrapStats={bootstrapped:0};this.type="legacy_search";this._reset();};s.prototype._reset=function(){"use strict";this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this.backendQueries=[];this._topreplace=false;this._inflightRequests={};var u=Math.random().toString();this.data.setQueryData({sid:u});this.view.setSid(u);this.recordStat('sid',u);this.recordStat('keypressed',0);};s.prototype.initEvents=function(){"use strict";this.core.subscribe('focus',function(event){if(!this.stats.session_start_time){this.recordStat('session_start_time',Date.now());var u=new Date(),v=u.getTimezoneOffset(),w=Date.now()-v*60*1000;this.recordStat('session_start_time_user_timezone',w);}}.bind(this));this.core.subscribe('blur',function(event){var u=Date.now();for(var v in this._inflightRequests){var w=this._inflightRequests[v],x=u-w;this.recordAvgStat('search_endpoint_ms_from_js',x);}this.recordStat('session_end_time',u);this.submit();}.bind(this));this.view.subscribe('select',function(u,v){this.recordSelectInfo(v);}.bind(this));this.view.subscribe('render',function(u,v){this.recordRender(v);}.bind(this));this.data.subscribe('activity',function(u,v){this.recordStat('pending_request',v.activity);}.bind(this));this.data.subscribe('respondValidUids',function(u,v){this.validUids=v.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(u,v){if(!v.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=v.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(u,v){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',v.value.length);this._inflightRequests[v.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(u,v){this._onloadTime=v.time;}.bind(this));this.data.subscribe('bootstrapped',function(u,v){this.bootstrapStats.endTime=v.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(u,v){this._extraRecorder.push(v);}.bind(this));this.data.subscribe('endpointStats',function(u,v){var w=v.fetch_end-v.fetch_start;if(v.value){this.recordAvgStat('search_endpoint_ms_from_js',w);}else this.bootstrapStats[v.type]=w;if(v.coeff2_ts)this.bootstrapStats.coeff2_ts=v.coeff2_ts;if(typeof v.browserCacheHit!='undefined')this.recordCountStat(v.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[v.value])delete this._inflightRequests[v.value];}.bind(this));this.data.subscribe('query',function(u,v){this.recordAvgStat('num_results_from_cache',v.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(u,v){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));this.data.subscribe('completeFetch',function(u,v){if(this.core.scubaInfo){var w=v.response,x={recv:v.stats.fetch_end-v.stats.fetch_start,render:Date.now()-v.stats.fetch_start,payload_size:JSON.stringify(w).length};if(!w.payload.entities)w.payload.entities=this.buildResults();this.logToScuba(w,x,this.core.scubaInfo,this.query,this.type);}}.bind(this));j.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);this.recordCountStat('count_keys_pressed');if(j.getKeyCode(event)==k.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));this.data.subscribe('beforeFetch',function(u,v){var w=v.request.data.value;if(!w)return;this.backendQueries.push(w);}.bind(this));};s.prototype.recordStat=function(u,v){"use strict";this.stats[u]=v;};s.prototype.recordCountStat=function(u){"use strict";var v=this.stats[u];this.stats[u]=v?v+1:1;};s.prototype.recordAvgStat=function(u,v){"use strict";if(this.avgStats[u]){this.avgStats[u][0]+=v;++this.avgStats[u][1];}else this.avgStats[u]=[v,1];};s.prototype.recordAppendStat=function(u,v){"use strict";if(!this.appendStats.hasOwnProperty(u))this.appendStats[u]=[];this.appendStats[u].push(v);};s.prototype.recordRender=function(u){"use strict";this.results=u.filter(function(w){return (w.uid!='search'&&w.type!='disabled_result'&&w.type!='header');}).map(function(w){return p(null,w);});var v=n.getViewportDimensions();this.recordStat('window_size_width',v.x);this.recordStat('window_size_height',v.y);if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());};s.prototype.recordSelectInfo=function(u){"use strict";var v=u.selected,w=u.index;if(v.groupIndex!==undefined)w=u.index-v.groupIndex-1;var x={href:v.path},y=v.dataGT?{gt:JSON.parse(v.dataGT)}:{};o('click',x,null,null,y);r('search').uai('click');if(v.uid=='search'){this.recordStat('selected_search',1);}else if(v.uid=='invite'){this.recordStat('selected_invite',1);}else{var z=v.rankType||v.render_type||v.type,aa=(z=='friend'?'user':z);this.recordStat('selected_'+aa,1);this.recordStat('selected_position',w);this.recordStat('selected_type',z);this.recordStat('selected_name_length',v.text.length);this.recordStat('selected_id',v.uid);this.recordStat('selected_degree',v.bootstrapped?1:2);var ba=m.parse(this.data.getTextToIndex(v)).tokens,ca=t(ba,this.query);if(ca)this.recordStat('matched_terms',ca);}var da={};this._extraRecorder.forEach(function(ea){ea(u,this.results,da);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(da));if(v.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',v.fromMemcache);this.recordStat('selected_websuggestion_source',v.websuggestion_source);}this.recordStat('selected_with_mouse',u.clicked?1:0);};s.prototype._dataToSubmit=function(){"use strict";this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this.backendQueries.length>0){if(this.backendQueries.length>this.data.logBackendQueriesWindow)this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow);this.recordStat('backend_queries',this.backendQueries);}var u=this.stats;for(var v in this.avgStats){var w=this.avgStats[v];u[v]=w[0]/w[1];}for(var x in this.appendStats)u[x]=JSON.stringify(this.appendStats[x]);return u;};s.prototype.buildResults=function(){"use strict";var u=(this.results||[]).map(function(v,w){var x=m.parse(this.data.getTextToIndex(v)).tokens,y=v.rankType||v.render_type||v.type,z=v.bootstrapped?1:0,aa=v.s_token||'',ba=(typeof v.index=='undefined')?100:v.index,ca=t(x,this.query)||this.query,da=v.index_rank,ea=v.match_type,fa=v.l_type,ga=v.vertical_type,ha=v.prefix_match,ia=v.prefix_length,ja=v.text,ka=v.category,la=v.subtext;if(typeof v.groupIndex=='number')return [v.groupIndex,v.indexInGroup,v.uid,y,z,aa,ca,da,ea,ha,ia,v.origIndex,fa,ga,ja,ka,la,ba];return [0,w,v.uid,y,z,aa,ca,da,ea,ha,ia,v.origIndex,fa,ga,ja,ka,la,ba];}.bind(this));return JSON.stringify(u);};s.prototype.submit=function(){"use strict";var u=this._dataToSubmit();switch(this.data.recordingRoute){case 'double_recording':if(Math.random()>.5){u.recorded_first='legacy';setTimeout(this.submitThroughAsyncRequest.bind(this,u),0);h.post(this._banzaiRoute,u,{delay:0,retry:true});}else{u.recorded_first='banzai';h.post(this._banzaiRoute,u,{delay:0,retry:true});setTimeout(this.submitThroughAsyncRequest.bind(this,u),0);}break;case 'random_recording':if(Math.random()>.5){this.submitThroughAsyncRequest(u);}else h.post(this._banzaiRoute,u,{delay:0,retry:true});break;case 'banzai_basic':h.post(this._banzaiRoute,u);break;case 'banzai_vital':h.post(this._banzaiRoute,u,{delay:0,retry:true});break;default:this.submitThroughAsyncRequest(u);}this._reset();};s.prototype.addLatencyToSample=function(u,v,w){"use strict";u.addInteger(w+'query_start',v.queryStart);u.addInteger(w+'query_end',v.queryEnd);u.addInteger(w+'keypress_query_end',v.keyPressToQueryEnd);u.addInteger(w+'render',v.render);u.addInteger(w+'keypress_render',v.keyPressToRender);};s.prototype.logToScuba=function(u,v,w,x,y){"use strict";var z=new l('search_facebar_js',null,{addBrowserFields:true,addGeoFields:true,addUser:true,addSearchVersion:true,addGatekeepers:{facebarGKs:true}});z.addInteger('sample_rate',w.sample_rate);z.addNormal('site',w.site);z.addDenorm('query',x);var aa=u.payload;aa.entities&&z.addInteger('num_entities',aa.entities.length);Object.keys(this.performanceTimings).forEach(function(ba){z.addInteger(ba,this.performanceTimings[ba]);}.bind(this),this);if(aa.results||aa.entries)z.addInteger('num_results',(aa.results||aa.entries).length);if(aa.gzipped_payload_size!==undefined)z.addInteger('gzipped_payload_size',aa.gzipped_payload_size);if(v.recv&&v.render>v.recv){z.addInteger('time_render',v.render-v.recv);z.addInteger('time_js_async',v.recv);}if(v.payload_size)z.addInteger('payload_size',v.payload_size);z.addInteger('query_id',u.queryId);z.addDenorm('user_id',i.getID());z.addDenorm('session_id',this.stats.sid);z.addNormal('typeahead_type',y);if(v.remoteQueryLatencies){this.addLatencyToSample(z,v.remoteQueryLatencies,'remote_');z.addInteger('remote_keypress_query_dispatch',v.remoteQueryLatencies.keyPressToQueryDispatch);z.addInteger('remote_keypress_query_start',v.remoteQueryLatencies.keyPressToQueryStart);z.addInteger('inflight_requests',v.remoteQueryLatencies.inflightRequests);}if(v.cacheQueryLatencies)this.addLatencyToSample(z,v.cacheQueryLatencies,'cache_');z.flush();};s.prototype.submitThroughAsyncRequest=function(u){"use strict";if(Object.keys(u).length>0)new g().setURI(this._endPoint).setMethod('POST').setData({stats:u}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(v){u.retry=true;new g().setURI(this._endPoint).setMethod('POST').setData({stats:u}).setOption('asynchronous',false).send();}.bind(this)).send();};var t=function(u,v){var w=m.parse(v);if(w.flatValue[w.flatValue.length-1]===' ')return w.flatValue;var x=w.tokens[w.tokens.length-1],y={};u.forEach(function(da){y[da]=(y[da]||0)+1;});var z={},aa=w.tokens.slice(0,w.tokens.length-1);aa.forEach(function(da){z[da]=(z[da]||0)+1;});for(var ba=0;ba<u.length;++ba){var ca=u[ba];if(ca.indexOf(x)===0&&(y[ca]-(z[ca]||0)>0)){aa.push(ca);return aa.join(' ');}}return undefined;};p(s.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',_banzaiRoute:'search'});e.exports=s;});
__d("TypeaheadSearchRecorderBasic",["SearchTypeaheadRecorder","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('SearchTypeaheadRecorder'),h=b('copyProperties'),i=b('emptyFunction');function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";new g(this._typeahead);};h(j.prototype,{disable:i});e.exports=j;});
__d("legacy:SearchRecorderBasicTypeaheadBehavior",["TypeaheadSearchRecorderBasic"],function(a,b,c,d){var e=b('TypeaheadSearchRecorderBasic');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.searchRecorderBasic=function(f){f.enableBehavior(e);};},3);
__d("SearchTypeaheadRenderer",["BadgeHelper","DOM","Env","MusicButtonManager","TypeaheadFacepile","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('BadgeHelper'),h=b('DOM'),i=b('Env'),j=b('MusicButtonManager'),k=b('TypeaheadFacepile'),l=b('TokenizeUtil');function m(n,o){var p=[],q=n.photos||n.photo;if(q){if(q instanceof Array){q=k.render(q);}else q=h.create('img',{alt:'',src:q});p.push(q);if(n.song){p.push(h.create('span',{className:'playButton'}));p.push(h.create('span',{className:'playLoader'}));}}var r;if(n.text){var s=n.alias,t=this.value,u=n.text;r=[u];if(s&&l.isQueryMatch(t,s)&&!l.isQueryMatch(t,u))r.push(h.create('span',{className:'alias'},[' \xB7 '+s]));if(n.is_verified)r.push(g.renderBadge('xsmall','verified'));p.push(h.create('span',{className:'text'},r));}if(n.category){var v=[n.category];if(n.is_external)v.push(h.create('span',{className:'arrow'}));var w=n.message?'preCategory':'category';p.push(h.create('span',{className:w},v));}if(n.message)p.push(h.create('span',{className:'category'},[n.message]));var x=n.subtextOverride||n.subtext;if(x)p.push(h.create('span',{className:'subtext'},[x]));var y=n.classNames||n.type||'',z=n.is_external?'_blank':'',aa=!n.song&&n.path||'';if(aa){if(!(/^https?\:\/\//).test(aa))aa=i.www_base+aa.substr(1);aa+=(aa.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var ba=h.create('a',{href:aa,rel:'ignore',target:z},p);if(n.song){ba.id='mb_'+(Math.random()*1e+06|0);setTimeout(j.addButton.bind(null,n.song.provider,ba.id,n.song.url,n.song.context,n.song.media_type),0);ba.onclick=this.ignoreClick;}var ca=h.create('li',{className:y},[ba]);if(n.text)ca.setAttribute('aria-label',n.text);return ca;}m.className='search';e.exports=m;});
__d("legacy:SearchTypeaheadRenderer",["SearchTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.search=b('SearchTypeaheadRenderer');},3);
void(0);
__d("TypeaheadSearchFilter",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){"use strict";this._typeahead=j;}i.prototype.enable=function(){"use strict";var j=this._typeahead,k=j.getView().seeMoreEndpoint;this._subscriptions=[g.subscribe('search/typeahead/updateFilter',function(l,m){if(m.filter_type=='web')j.getView().queryData.form='FBKBFR';j.getView().queryData.type=m.filter_type;}),g.subscribe('search/typeahead/updateSeeMoreEndpoint',function(l,m){j.getView().seeMoreEndpoint=m;}),g.subscribe('page_transition',function(l,m){if(j.getView().queryData.form)delete j.getView().queryData.form;delete j.getView().queryData.type;j.getView().seeMoreEndpoint=k;},g.SUBSCRIBE_NEW)];};i.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(j){j.unsubscribe();});this._subscriptions=null;};h(i.prototype,{_subscription:null});e.exports=i;});
__d("legacy:SearchFilterTypeaheadBehavior",["TypeaheadSearchFilter"],function(a,b,c,d){var e=b('TypeaheadSearchFilter');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.initFilters=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadDetectQueryLocale",[],function(a,b,c,d,e,f){function g(h){"use strict";this._typeahead=h;this._data=h.getData();this._queryCache={'':this._data.queryCache,ja_JP:{},zh_TW:{}};}g.prototype.enable=function(){"use strict";this._previousLocale='';this._reset=this._typeahead.subscribe('reset',this._swapQueryCache.bind(this,''));this._beforeQuery=this._data.subscribe('beforeQuery',function(h,i){var j=i.value;if(j===''){this._swapQueryCache('');return;}var k=null,l=j.charCodeAt(j.length-1);if(12352<=l&&l<=12543){k='ja_JP';}else if(12544<=l&&l<=12735)k='zh_TW';this._swapQueryCache(k);}.bind(this));};g.prototype.disable=function(){"use strict";this._swapQueryCache('');this._data.unsubscribe(this._beforeQuery);this._typeahead.ubsubscribe(this._reset);};g.prototype._swapQueryCache=function(h){"use strict";if(h===null||h===this._previousLocale)return;this._data.queryCache=this._queryCache[h];this._data.setQueryData({query_locale:h});this._previousLocale=h;};e.exports=g;});
__d("TypeaheadExcludeBootstrapFromQueryCache",[],function(a,b,c,d,e,f){function g(h){"use strict";this._data=h.getData();}g.prototype.enable=function(){"use strict";this._buildingQueryCache=false;this._buildQueryCache=this._data.subscribe('buildQueryCache',function(){this._buildingQueryCache=true;}.bind(this));this._mergeUids=this._data.subscribe('mergeUids',function(h,i){if(this._buildingQueryCache)i.local_uids.splice(0,i.local_uids.length);}.bind(this));this._fetchComplete=this._data.subscribe('fetchComplete',function(){this._buildingQueryCache=false;}.bind(this));};g.prototype.disable=function(){"use strict";this._data.unsubscribe(this._buildQueryCache);this._data.unsubscribe(this._mergeUids);this._data.unsubscribe(this._fetchComplete);};e.exports=g;});